(function(){var config=window.jivo_config;function getElementsByClassName(e){var t;try{t=document.getElementsByClassName(e)}catch(i){t=[];var n=new RegExp("\\b"+e+"\\b");var o=document.getElementsByTagName("*");for(var r=0;r<o.length;r++){var a=o[r].className;if(n.test(a)){t.push(o[r])}}}return t}(function(){var e=this;var t=e._;var i={};var n=Array.prototype,o=Object.prototype,r=Function.prototype;var a=n.push,s=n.slice,c=n.concat,l=o.toString,u=o.hasOwnProperty;var f=n.forEach,d=n.map,h=n.reduce,g=n.reduceRight,v=n.filter,m=n.every,p=n.some,_=n.indexOf,y=n.lastIndexOf,b=Array.isArray,w=Object.keys,C=false;var E=function(e){if(e instanceof E)return e;if(!(this instanceof E))return new E(e);this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=E}exports._=E}else{e._=E}E.VERSION="1.4.4";var T=E.each=E.forEach=function(e,t,n){if(e==null)return;if(f&&e.forEach===f){e.forEach(t,n)}else if(e.length===+e.length){for(var o=0,r=e.length;o<r;o++){if(t.call(n,e[o],o,e)===i)return}}else{for(var a in e){if(E.has(e,a)){if(t.call(n,e[a],a,e)===i)return}}}};E.map=E.collect=function(e,t,i){var n=[];if(e==null)return n;if(d&&e.map===d)return e.map(t,i);T(e,function(e,o,r){n[n.length]=t.call(i,e,o,r)});return n};var j="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(e,t,i,n){var o=arguments.length>2;if(e==null)e=[];if(h&&e.reduce===h){if(n)t=E.bind(t,n);return o?e.reduce(t,i):e.reduce(t)}T(e,function(e,r,a){if(!o){i=e;o=true}else{i=t.call(n,i,e,r,a)}});if(!o)throw new TypeError(j);return i};E.reduceRight=E.foldr=function(e,t,i,n){var o=arguments.length>2;if(e==null)e=[];if(g&&e.reduceRight===g){if(n)t=E.bind(t,n);return o?e.reduceRight(t,i):e.reduceRight(t)}var r=e.length;if(r!==+r){var a=E.keys(e);r=a.length}T(e,function(s,c,l){c=a?a[--r]:--r;if(!o){i=e[c];o=true}else{i=t.call(n,i,e[c],c,l)}});if(!o)throw new TypeError(j);return i};E.find=E.detect=function(e,t,i){var n;I(e,function(e,o,r){if(t.call(i,e,o,r)){n=e;return true}});return n};E.filter=E.select=function(e,t,i){var n=[];if(e==null)return n;if(v&&e.filter===v)return e.filter(t,i);T(e,function(e,o,r){if(t.call(i,e,o,r))n[n.length]=e});return n};E.reject=function(e,t,i){return E.filter(e,function(e,n,o){return!t.call(i,e,n,o)},i)};E.every=E.all=function(e,t,n){t||(t=E.identity);var o=true;if(e==null)return o;if(m&&e.every===m)return e.every(t,n);T(e,function(e,r,a){if(!(o=o&&t.call(n,e,r,a)))return i});return!!o};var I=E.some=E.any=function(e,t,n){t||(t=E.identity);var o=false;if(e==null)return o;if(p&&e.some===p)return e.some(t,n);T(e,function(e,r,a){if(o||(o=t.call(n,e,r,a)))return i});return!!o};E.contains=E.include=function(e,t){if(e==null)return false;if(_&&e.indexOf===_)return e.indexOf(t)!=-1;return I(e,function(e){return e===t})};E.invoke=function(e,t){var i=s.call(arguments,2);var n=E.isFunction(t);return E.map(e,function(e){return(n?t:e[t]).apply(e,i)})};E.pluck=function(e,t){return E.map(e,function(e){return e[t]})};E.where=function(e,t,i){if(E.isEmpty(t))return i?null:[];return E[i?"find":"filter"](e,function(e){for(var i in t){if(t[i]!==e[i])return false}return true})};E.findWhere=function(e,t){return E.where(e,t,true)};E.max=function(e,t,i){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.max.apply(Math,e)}if(!t&&E.isEmpty(e))return-Infinity;var n={computed:-Infinity,value:-Infinity};T(e,function(e,o,r){var a=t?t.call(i,e,o,r):e;a>=n.computed&&(n={value:e,computed:a})});return n.value};E.min=function(e,t,i){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.min.apply(Math,e)}if(!t&&E.isEmpty(e))return Infinity;var n={computed:Infinity,value:Infinity};T(e,function(e,o,r){var a=t?t.call(i,e,o,r):e;a<n.computed&&(n={value:e,computed:a})});return n.value};E.shuffle=function(e){var t;var i=0;var n=[];T(e,function(e){t=E.random(i++);n[i-1]=n[t];n[t]=e});return n};var x=function(e){return E.isFunction(e)?e:function(t){return t[e]}};E.sortBy=function(e,t,i){var n=x(t);return E.pluck(E.map(e,function(e,t,o){return{value:e,index:t,criteria:n.call(i,e,t,o)}}).sort(function(e,t){var i=e.criteria;var n=t.criteria;if(i!==n){if(i>n||i===void 0)return 1;if(i<n||n===void 0)return-1}return e.index<t.index?-1:1}),"value")};var N=function(e,t,i,n){var o={};var r=x(t||E.identity);T(e,function(t,a){var s=r.call(i,t,a,e);n(o,s,t)});return o};E.groupBy=function(e,t,i){return N(e,t,i,function(e,t,i){(E.has(e,t)?e[t]:e[t]=[]).push(i)})};E.countBy=function(e,t,i){return N(e,t,i,function(e,t){if(!E.has(e,t))e[t]=0;e[t]++})};E.sortedIndex=function(e,t,i,n){i=i==null?E.identity:x(i);var o=i.call(n,t);var r=0,a=e.length;while(r<a){var s=r+a>>>1;i.call(n,e[s])<o?r=s+1:a=s}return r};E.toArray=function(e){if(!e)return[];if(E.isArray(e))return s.call(e);if(e.length===+e.length)return E.map(e,E.identity);return E.values(e)};E.size=function(e){if(e==null)return 0;return e.length===+e.length?e.length:E.keys(e).length};E.first=E.head=E.take=function(e,t,i){if(e==null)return void 0;return t!=null&&!i?s.call(e,0,t):e[0]};E.initial=function(e,t,i){return s.call(e,0,e.length-(t==null||i?1:t))};E.last=function(e,t,i){if(e==null)return void 0;if(t!=null&&!i){return s.call(e,Math.max(e.length-t,0))}else{return e[e.length-1]}};E.rest=E.tail=E.drop=function(e,t,i){return s.call(e,t==null||i?1:t)};E.compact=function(e){return E.filter(e,E.identity)};var k=function(e,t,i){T(e,function(e){if(E.isArray(e)){t?a.apply(i,e):k(e,t,i)}else{i.push(e)}});return i};E.flatten=function(e,t){return k(e,t,[])};E.without=function(e){return E.difference(e,s.call(arguments,1))};E.uniq=E.unique=function(e,t,i,n){if(E.isFunction(t)){n=i;i=t;t=false}var o=i?E.map(e,i,n):e;var r=[];var a=[];T(o,function(i,n){if(t?!n||a[a.length-1]!==i:!E.contains(a,i)){a.push(i);r.push(e[n])}});return r};E.union=function(){return E.uniq(c.apply(n,arguments))};E.intersection=function(e){var t=s.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})};E.difference=function(e){var t=c.apply(n,s.call(arguments,1));return E.filter(e,function(e){return!E.contains(t,e)})};E.zip=function(){var e=s.call(arguments);var t=E.max(E.pluck(e,"length"));var i=new Array(t);for(var n=0;n<t;n++){i[n]=E.pluck(e,""+n)}return i};E.object=function(e,t){if(e==null)return{};var i={};for(var n=0,o=e.length;n<o;n++){if(t){i[e[n]]=t[n]}else{i[e[n][0]]=e[n][1]}}return i};E.indexOf=function(e,t,i){if(e==null)return-1;var n=0,o=e.length;if(i){if(typeof i=="number"){n=i<0?Math.max(0,o+i):i}else{n=E.sortedIndex(e,t);return e[n]===t?n:-1}}if(_&&e.indexOf===_)return e.indexOf(t,i);for(;n<o;n++)if(e[n]===t)return n;return-1};E.lastIndexOf=function(e,t,i){if(e==null)return-1;var n=i!=null;if(y&&e.lastIndexOf===y){return n?e.lastIndexOf(t,i):e.lastIndexOf(t)}var o=n?i:e.length;while(o--)if(e[o]===t)return o;return-1};E.range=function(e,t,i){if(arguments.length<=1){t=e||0;e=0}i=arguments[2]||1;var n=Math.max(Math.ceil((t-e)/i),0);var o=0;var r=new Array(n);while(o<n){r[o++]=e;e+=i}return r};E.bind=function(e,t){if(e.bind===C&&C)return C.apply(e,s.call(arguments,1));var i=s.call(arguments,2);return function(){return e.apply(t,i.concat(s.call(arguments)))}};E.partial=function(e){var t=s.call(arguments,1);return function(){return e.apply(this,t.concat(s.call(arguments)))}};E.bindAll=function(e){var t=s.call(arguments,1);if(t.length===0)t=E.functions(e);T(t,function(t){e[t]=E.bind(e[t],e)});return e};E.memoize=function(e,t){var i={};t||(t=E.identity);return function(){var n=t.apply(this,arguments);return E.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}};E.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)};E.defer=function(e){return E.delay.apply(E,[e,1].concat(s.call(arguments,1)))};E.throttle=function(e,t){var i,n,o,r;var a=0;var s=function(){a=new Date;o=null;r=e.apply(i,n)};return function(){var c=new Date;var l=t-(c-a);i=this;n=arguments;if(l<=0){clearTimeout(o);o=null;a=c;r=e.apply(i,n)}else if(!o){o=setTimeout(s,l)}return r}};E.debounce=function(e,t,i){var n,o;return function(){var r=this,a=arguments;var s=function(){n=null;if(!i)o=e.apply(r,a)};var c=i&&!n;clearTimeout(n);n=setTimeout(s,t);if(c)o=e.apply(r,a);return o}};E.once=function(e){var t=false,i;return function(){if(t)return i;t=true;i=e.apply(this,arguments);e=null;return i}};E.wrap=function(e,t){return function(){var i=[e];a.apply(i,arguments);return t.apply(this,i)}};E.compose=function(){var e=arguments;return function(){var t=arguments;for(var i=e.length-1;i>=0;i--){t=[e[i].apply(this,t)]}return t[0]}};E.after=function(e,t){if(e<=0)return t();return function(){if(--e<1){return t.apply(this,arguments)}}};E.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)if(E.has(e,i))t[t.length]=i;return t};E.values=function(e){var t=[];for(var i in e)if(E.has(e,i))t.push(e[i]);return t};E.pairs=function(e){var t=[];for(var i in e)if(E.has(e,i))t.push([i,e[i]]);return t};E.invert=function(e){var t={};for(var i in e)if(E.has(e,i))t[e[i]]=i;return t};E.functions=E.methods=function(e){var t=[];for(var i in e){if(E.isFunction(e[i]))t.push(i)}return t.sort()};E.extend=function(e){T(s.call(arguments,1),function(t){if(t){for(var i in t){e[i]=t[i]}}});return e};E.pick=function(e){var t={};var i=c.apply(n,s.call(arguments,1));T(i,function(i){if(i in e)t[i]=e[i]});return t};E.omit=function(e){var t={};var i=c.apply(n,s.call(arguments,1));for(var o in e){if(!E.contains(i,o))t[o]=e[o]}return t};E.defaults=function(e){T(s.call(arguments,1),function(t){if(t){for(var i in t){if(e[i]==null)e[i]=t[i]}}});return e};E.clone=function(e){if(!E.isObject(e))return e;return E.isArray(e)?e.slice():E.extend({},e)};E.tap=function(e,t){t(e);return e};var S=function(e,t,i,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;if(e instanceof E)e=e._wrapped;if(t instanceof E)t=t._wrapped;var o=l.call(e);if(o!=l.call(t))return false;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return false;var r=i.length;while(r--){if(i[r]==e)return n[r]==t}i.push(e);n.push(t);var a=0,s=true;if(o=="[object Array]"){a=e.length;s=a==t.length;if(s){while(a--){if(!(s=S(e[a],t[a],i,n)))break}}}else{var c=e.constructor,u=t.constructor;if(c!==u&&!(E.isFunction(c)&&c instanceof c&&E.isFunction(u)&&u instanceof u)){return false}for(var f in e){if(E.has(e,f)){a++;if(!(s=E.has(t,f)&&S(e[f],t[f],i,n)))break}}if(s){for(f in t){if(E.has(t,f)&&!a--)break}s=!a}}i.pop();n.pop();return s};E.isEqual=function(e,t){return S(e,t,[],[])};E.isEmpty=function(e){if(e==null)return true;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return false;return true};E.isElement=function(e){return!!(e&&e.nodeType===1)};E.isArray=b||function(e){return l.call(e)=="[object Array]"};E.isObject=function(e){return e===Object(e)};T(["Arguments","Function","String","Number","Date","RegExp"],function(e){E["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}});if(!E.isArguments(arguments)){E.isArguments=function(e){return!!(e&&E.has(e,"callee"))}}if(typeof/./!=="function"){E.isFunction=function(e){return typeof e==="function"}}E.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};E.isNaN=function(e){return E.isNumber(e)&&e!=+e};E.isBoolean=function(e){return e===true||e===false||l.call(e)=="[object Boolean]"};E.isNull=function(e){return e===null};E.isUndefined=function(e){return e===void 0};E.has=function(e,t){return u.call(e,t)};E.noConflict=function(){e._=t;return this};E.identity=function(e){return e};E.times=function(e,t,i){var n=Array(e);for(var o=0;o<e;o++)n[o]=t.call(i,o);return n};E.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};A.unescape=E.invert(A.escape);var O={escape:new RegExp("["+E.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(A.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(e){E[e]=function(t){if(t==null)return"";return(""+t).replace(O[e],function(t){return A[e][t]})}});E.result=function(e,t){if(e==null)return null;var i=e[t];return E.isFunction(i)?i.call(e):i};E.mixin=function(e){T(E.functions(e),function(t){var i=E[t]=e[t];E.prototype[t]=function(){var e=[this._wrapped];a.apply(e,arguments);return H.call(this,i.apply(E,e))}})};var D=0;E.uniqueId=function(e){var t=++D+"";return e?e+t:t};E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/;var L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var R=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(e,t,i){var n;i=E.defaults({},i,E.templateSettings);var o=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g");var r=0;var a="__p+='";e.replace(o,function(t,i,n,o,s){a+=e.slice(r,s).replace(R,function(e){return"\\"+L[e]});if(i){a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"}if(n){a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"}if(o){a+="';\n"+o+"\n__p+='"}r=s+t.length;return t});a+="';\n";if(!i.variable)a="with(obj||{}){\n"+a+"}\n";a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(i.variable||"obj","_",a)}catch(s){s.source=a;throw s}if(t)return n(t,E);var c=function(e){return n.call(this,e,E)};c.source="function("+(i.variable||"obj")+"){\n"+a+"}";return c};E.chain=function(e){return E(e).chain()};var H=function(e){return this._chain?E(e).chain():e};E.mixin(E);T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];E.prototype[e]=function(){var i=this._wrapped;t.apply(i,arguments);if((e=="shift"||e=="splice")&&i.length===0)delete i[0];return H.call(this,i)}});T(["concat","join","slice"],function(e){var t=n[e];E.prototype[e]=function(){return H.call(this,t.apply(this._wrapped,arguments))}});E.extend(E.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);var machina=function(t,i){var n=[].slice;var o="transition";var r="handler";var a="handling";var s="handled";var c="nohandler";var l="transition";var u="invalidstate";var f="deferred";var d="newfsm";var h={makeFsmNamespace:function(){var e=0;return function(){return"fsm."+e++}}(),getDefaultOptions:function(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},eventQueue:[],namespace:h.makeFsmNamespace(),targetReplayState:"",state:i,priorState:i,_priorAction:"",_currentAction:""}}};if(!t.deepExtend){var g={"*":function(e,t,i){e[t]=i},object:function(e,t,i){e[t]=p({},e[t]||{},i)},array:function(e,i,n){e[i]=[];t.each(n,function(t,n){g[m(t)](e[i],n,t)},this)}},v=function(e){if(t.isArray(e)){return"array"}if(t.isDate(e)){return"date"}if(t.isRegExp(e)){return"regex"}return typeof e},m=function(e){var t=v(e);return g[t]?t:"*"},p=function(e){t.each(n.call(arguments,1),function(i){t.each(i,function(t,i){g[m(t)](e,i,t)})});return e};t.mixin({deepExtend:p})}var _=function(e){t.extend(this,e);t.defaults(this,h.getDefaultOptions());this.initialize.apply(this,arguments);w.emit(d,this);if(this.initialState){this.transition(this.initialState)}};t.extend(_.prototype,{initialize:function(){},emit:function(i){var o=arguments;if(this.eventListeners["*"]){t.each(this.eventListeners["*"],function(t){try{t.apply(this,n.call(o,0))}catch(i){reportException(i);log(e.message)}},this)}if(this.eventListeners[i]){t.each(this.eventListeners[i],function(t){try{t.apply(this,n.call(o,1))}catch(i){reportException(i);log(e.message)}},this)}},handle:function(e){if(!this.inExitHandler){var o=this.states,l=this.state,u=n.call(arguments,0),f,d,h,g;this.currentActionArgs=u;if(o[l][e]||o[l]["*"]||this["*"]){f=o[l][e]?e:"*";h=f==="*";if(o[l][f]){d=o[l][f];g=l+"."+f}else{d=this["*"];g="*"}if(!this._currentAction)this._currentAction=g;this.emit.call(this,a,{inputType:e,args:u.slice(1)});if(t.isFunction(d))d=d.apply(this,h?u:u.slice(1));if(t.isString(d))this.transition(d);this.emit.call(this,s,{inputType:e,args:u.slice(1)});this._priorAction=this._currentAction;this._currentAction="";this.processQueue(r)}else{this.emit.call(this,c,{inputType:e,args:u.slice(1)})}this.currentActionArgs=i}},transition:function(e){if(!this.inExitHandler&&e!==this.state){var t;if(this.states[e]){this.targetReplayState=e;this.priorState=this.state;this.state=e;t=this.priorState;if(this.states[t]&&this.states[t]._onExit){this.inExitHandler=true;this.states[t]._onExit.call(this);this.inExitHandler=false}this.emit.call(this,l,{fromState:t,action:this._currentAction,toState:e});if(this.states[e]._onEnter){this.states[e]._onEnter.call(this)}if(this.targetReplayState===e){this.processQueue(o)}return}this.emit.call(this,u,{state:this.state,attemptedState:e})}},processQueue:function(e){var i=e===o?function(e){return e.type===o&&(!e.untilState||e.untilState===this.state)}:function(e){return e.type===r};var n=t.filter(this.eventQueue,i,this);this.eventQueue=t.difference(this.eventQueue,n);t.each(n,function(e){this.handle.apply(this,e.args)},this)},clearQueue:function(e,i){if(!e){this.eventQueue=[]}else{var n;if(e===o){n=function(e){return e.type===o&&(i?e.untilState===i:true)}}else if(e===r){n=function(e){return e.type===r}}this.eventQueue=t.filter(this.eventQueue,n)}},deferUntilTransition:function(e){if(this.currentActionArgs){var t={type:o,untilState:e,args:this.currentActionArgs};this.eventQueue.push(t);this.emit.call(this,f,{state:this.state,queuedArgs:t})}},deferUntilNextHandler:function(){if(this.currentActionArgs){var e={type:o,args:this.currentActionArgs};this.eventQueue.push(e);this.emit.call(this,f,{state:this.state,queuedArgs:e})}},on:function(e,t){var i=this;if(!i.eventListeners[e]){i.eventListeners[e]=[]}i.eventListeners[e].push(t);return{eventName:e,callback:t,off:function(){i.off(e,t)}}},off:function(e,i){if(!e){this.eventListeners={}}else{if(this.eventListeners[e]){if(i){this.eventListeners[e]=t.without(this.eventListeners[e],i)}else{this.eventListeners[e]=[]}}}}});_.prototype.trigger=_.prototype.emit;var y=function(){};var b=function(e,i,n){var o;if(i&&i.hasOwnProperty("constructor")){o=i.constructor}else{o=function(){e.apply(this,arguments)}}t.deepExtend(o,e);y.prototype=e.prototype;o.prototype=new y;if(i){t.deepExtend(o.prototype,i)}if(n){t.deepExtend(o,n)}o.prototype.constructor=o;o.__super__=e.prototype;return o};_.extend=function(e,t){var i=b(this,e,t);i.extend=this.extend;return i};var w={Fsm:_,utils:h,on:function(e,t){if(!this.eventListeners[e]){this.eventListeners[e]=[]}this.eventListeners[e].push(t);return t},off:function(e,i){if(this.eventListeners[e]){this.eventListeners[e]=t.without(this.eventListeners[e],i)}},trigger:function(e){var i=0,o,r=arguments,a=this.eventListeners[e]||[];if(a&&a.length){t.each(a,function(e){e.apply(null,n.call(r,1))})}},eventListeners:{newFsm:[]}};w.emit=w.trigger;return w}(_);(function(){var e,t,i;e=window.device;window.device={};i=window.navigator.userAgent.toLowerCase();device.ios=function(){return device.iphone()||device.ipod()||device.ipad()};device.iphone=function(){return t("iphone")};device.ipod=function(){return t("ipod")};device.ipad=function(){return t("ipad")};device.android=function(){return t("android")};device.androidPhone=function(){return device.android()&&t("mobile")};device.androidTablet=function(){return device.android()&&!t("mobile")};device.blackberry=function(){return t("blackberry")||t("bb10")||t("rim")};device.blackberryPhone=function(){return device.blackberry()&&!t("tablet")};device.blackberryTablet=function(){return device.blackberry()&&t("tablet")};device.windows=function(){return t("windows")};device.windowsPhone=function(){return device.windows()&&t("phone")};device.windowsTablet=function(){return device.windows()&&t("touch")};device.fxos=function(){return(t("(mobile;")||t("(tablet;"))&&t("; rv:")};device.fxosPhone=function(){return device.fxos()&&t("mobile")};device.fxosTablet=function(){return device.fxos()&&t("tablet")};device.meego=function(){return t("meego")};device.cordova=function(){return window.cordova&&location.protocol==="file:"};device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()};device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()};device.desktop=function(){return!device.tablet()&&!device.mobile()};device.portrait=function(){return window.innerHeight/window.innerWidth>1};device.landscape=function(){return window.innerHeight/window.innerWidth<1};device.noConflict=function(){window.device=e;return this};t=function(e){return i.indexOf(e)!==-1}}).call(this);function log(){if(!("logs"in config)){return}var e=Array.prototype.slice.call(arguments);if(typeof console!="undefined"&&typeof console.log=="function"){if(window.opera){var t=0;while(t<arguments.length){console.log("Item "+(t+1)+": "+arguments[t]);t++}}else if(e.length==1&&typeof e[0]=="string"){console.log(e.toString())}else{console.log(e)}}else if(typeof console!="undefined"&&typeof console.log=="object"){Function.prototype.call.call(console.log,console,e)}}var underscore=_.noConflict();underscore.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var ie7=navigator.appVersion.indexOf("MSIE 7.")==-1?false:true;var ie8=navigator.appVersion.indexOf("MSIE 8.")==-1?false:true;var ie9=navigator.appVersion.indexOf("MSIE 9.")==-1?false:true;var ie=navigator.appVersion.indexOf("MSIE")==-1?false:true;function loadScript(e,t){var i=document.createElement("script");i.type="text/javascript";if(i.readyState){i.onreadystatechange=function(){if(i.readyState=="loaded"||i.readyState=="complete"){i.onreadystatechange=null;t()}}}else{i.onload=function(){t()}}i.src=e;if(typeof log!="undefined")log("adding script "+e);document.getElementsByTagName("head")[0].appendChild(i)}function setIframeLoadCallback(e,t){if(e.readyState){log("Using readyState callback");e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=null;t()}}}else{log("Using onload callback");e.onload=function(){if(e.contentWindow.location.href!="about:blank"){t();e.onload=null}}}}var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(e,t){e=String(e);t=t||2;while(e.length<t)e="0"+e;return e};return function(o,r,a){var s=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(o)=="[object String]"&&!/\d/.test(o)){r=o;o=undefined}if(typeof o==="string"&&isNaN(new Date(o))){o=o.replace(/-/g,"/").replace("T"," ").split(".").shift()+"Z"}o=o?new Date(o):new Date;if(isNaN(o))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]);if(r.slice(0,4)=="UTC:"){r=r.slice(4);a=true}var c=a?"getUTC":"get",l=o[c+"Date"](),u=o[c+"Day"](),f=o[c+"Month"](),d=o[c+"FullYear"](),h=o[c+"Hours"](),g=o[c+"Minutes"](),v=o[c+"Seconds"](),m=o[c+"Milliseconds"](),p=a?0:o.getTimezoneOffset(),_={d:l,dd:n(l),ddd:s.i18n.dayNames[u],dddd:s.i18n.dayNames[u+7],m:f+1,mm:n(f+1),mmm:s.i18n.monthNames[f],mmmm:s.i18n.monthNames[f+12],yy:String(d).slice(2),yyyy:d,h:h%12||12,hh:n(h%12||12),H:h,HH:n(h),M:g,MM:n(g),s:v,ss:n(v),l:n(m,3),L:n(m>99?Math.round(m/10):m),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:a?"UTC":(String(o).match(t)||[""]).pop().replace(i,""),o:(p>0?"-":"+")+n(Math.floor(Math.abs(p)/60)*100+Math.abs(p)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return r.replace(e,function(e){return e in _?_[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};function installF9ReloadCss(){$("body").keydown(function(e){if(e.keyCode=="120"){log("reloading css");var t,i,n;i=document.getElementsByTagName("link");for(t=0;t<i.length;t++){n=i[t];if(n.rel.toLowerCase().indexOf("stylesheet")>=0&&n.href){var o=n.href.replace(/(&|%5C?)forceReload=\d+/,"");n.href=o+(o.indexOf("?")>=0?"&":"?")+"forceReload="+(new Date).valueOf()}}}})}var base_langpack={"b_onlineCallDefaultText":"\u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u043d\u0430\u043c \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e!","c_callConnected":"\u0412\u044b\u0437\u043e\u0432 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d","c_callDisconnected":"\u0412\u044b\u0437\u043e\u0432 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d","c_callProcessing":"\u0412\u044b\u0437\u044b\u0432\u0430\u0435\u043c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430...","defOfflineFormText":"\u041e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u044d\u0442\u043e\u0439 \u0444\u043e\u0440\u043c\u0435, \u0438 \u043c\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u0435\u0433\u043e \u043d\u0430 e-mail \u0438 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442\u0432\u0435\u0442\u0438\u043c!","defOfflineWidgetLabel":"\u041e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u043d\u0430\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","defOfflineWidgetLabelMobile":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","defOnlineWidgetLabel":"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043d\u0430\u043c, \u043c\u044b \u043e\u043d\u043b\u0430\u0439\u043d!","defOnlineWidgetLabelMobile":"\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442 \u043e\u043d\u043b\u0430\u0439\u043d","defRuleInvitationText":"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435! \u0427\u0435\u043c \u043c\u043e\u0433\u0443 \u043f\u043e\u043c\u043e\u0447\u044c?","lblAgentDisconnected":"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f","lblCallMe":"\u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c","lblCaptcha":"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438","lblCaptchaError":"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043a\u043e\u0434, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437","lblChatEnded":"\u0414\u0438\u0430\u043b\u043e\u0433 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d","lblChatIsOnline":"\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442 \u043e\u043d\u043b\u0430\u0439\u043d","lblConnectedToAgent":"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435!","lblConnectionLost":"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043e. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c...","lblDeclineFile":"\u041e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c","lblDefaultCobrowseComment":"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435","lblEnterMessageHere":"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 Enter","lblEvaluateCancel":"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c","lblEvaluatePlease":"\u041e\u0446\u0435\u043d\u0438\u0442\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f","lblEvaluateThanks":"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043e\u0446\u0435\u043d\u043a\u0443!","lblHangUp":"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435","lblHangUpShort":"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c","lblIntroduceButton":"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u044c\u0441\u044f","lblIntroduceName":"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f","lblIntroduceRequest":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435\u0441\u044c","lblIntroduceRequestBefore":"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435\u0441\u044c \u0438 \u043d\u0430\u0447\u043d\u0438\u0442\u0435 \u0447\u0430\u0442!","lblLeaveMessage":"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","lblLookingForFreeAgent":"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u0441\u044f...","lblMessageError":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u043f\u043e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c","lblNegative":"\u041f\u043b\u043e\u0445\u043e","lblNewMessage":"\u041d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435!","lblNoOperators":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0441\u0435\u0439\u0447\u0430\u0441 \u043d\u0438\u043a\u0442\u043e \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u0432\u0435\u0442\u0438\u0442\u044c","lblOfflineMessageSend":"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e","lblOperatorsOnline":"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u043e\u043d\u043b\u0430\u0439\u043d","lblPencilHint":"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043d\u0430\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","lblPhoneHint":"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u00ab\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c\u00bb, \u0447\u0442\u043e\u0431\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0434\u043b\u044f \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u0430.\r\n\u0412\u0430\u0448\u0430 \u0432\u0435\u0431-\u043a\u0430\u043c\u0435\u0440\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0435 \u0431\u0443\u0434\u0435\u0442","lblPositive":"\u0425\u043e\u0440\u043e\u0448\u043e","lblPwrBy":"\u0427\u0430\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d <a href=\"http:\/\/jivosite.ru\/_URL_\" target=\"_blank\"><span class=\"j1\">Jivo<\/span><span class=\"j2\">Site<\/span><\/a>","lblReceiveFile":"\u041f\u0440\u0438\u043d\u044f\u0442\u044c","lblReopenedElseWhere":"\u0414\u0438\u0430\u043b\u043e\u0433 \u043e\u0442\u043a\u0440\u044b\u0442 \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043e\u043a\u043d\u0435","lblSelectDep":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0442\u0434\u0435\u043b","lblSend":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c","lblSendBefore":"\u041d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","lblSendingFile":"_AGENT_ \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 \u0412\u0430\u043c \u0444\u0430\u0439\u043b: _FILE_","lblThankYouMessage":"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435! \u041c\u044b&nbsp;\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0441&nbsp;\u0412\u0430\u043c\u0438 \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f","lblTransferred":"\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0435\u0440\u0435\u0434\u0430\u043d \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 _AGENT_","lblView":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c","lblWaitForOperator":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043e\u0436\u0438\u0434\u0430\u0439\u0442\u0435 \u043e\u0442\u0432\u0435\u0442\u0430 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430...","lblWebPhoneFlashError":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f Flash \u043d\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u044b\u0437\u043e\u0432. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0447\u0430\u0442\u043e\u043c","lblWebPhoneMicError":"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c","lblWebPhoneNotAvail":"\u0412\u044b\u0437\u043e\u0432 \u043d\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d \u0438\u0437-\u0437\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0441 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c","lblWebPhoneNotConnected":"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u043e\u043b\u043e\u0441\u043e\u0432\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0447\u0430\u0442\u043e\u043c","lblYourEmail":"\u0412\u0430\u0448 E-mail","lblYourMessage":"\u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","lblYourPhone":"\u0412\u0430\u0448 \u0442\u0435\u043b\u0435\u0444\u043e\u043d","lnkCloseThisWindow":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c","lnkRestartChat":"\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","ofl_enterEmail":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 e-mail","ofl_enterMessage":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","ofl_enterName":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f","ofl_enterValidEmail":"\u0423\u043a\u0430\u0437\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 e-mail","ofl_enterValidPhone":"\u0423\u043a\u0430\u0437\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0435\u043b\u0435\u0444\u043e\u043d","seo_copyrightTextNew":"\u0427\u0430\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d _JIVOSITE_"};function translate(e){if("custom_langpack"in config&&e in config.custom_langpack){return config.custom_langpack[e].replace(/\n/g,"<br />")}return translate_basic(e)}function translate_basic(e){if(e in base_langpack){return base_langpack[e].replace(/\n/g,"<br />")}return e}function cookie(e,t,i){if(e!="__utmz"){e=["jv",e,config.widget_id].join("_")}if(arguments.length>1&&String(t)!=="[object Object]"){if(typeof i=="undefined"){i={}}if(t===null||t===undefined){log("Clearing COOKIE "+e);i.expires=-1}else{log("Set COOKIE "+e+" with value "+t)}if(typeof i.expires==="number"){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}t=String(t);return document.cookie=[encodeURIComponent(e),"=",encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"","; path=/"].join("")}i=t||{};var r,a=i.raw?function(e){return e}:decodeURIComponent;return(r=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?a(r[1]):null}function getJSONP(e,t){var i=new jivoXHR;i.open("GET",e);i.onload=t;i.send()}function getJSONPWithData(e,t,i){e+="?cb=?";t["t"]=(new Date).getTime();for(var n in t){e+="&"+n+"="+encodeURIComponent(t[n])}return getJSONP(e,i)}var error_sent_cnt=0;function reportException(e){if("production"=="production"){if(++error_sent_cnt>3){return}try{getJSONPWithData("//err.jivosite.com/widget",{widget_id:config.widget_id,message:e.message,url:window.top.location.href,lineNumber:e.lineNumber,fileName:e.fileName},function(e){log(e)})}catch(e){log(e.message)}}}function createXPathFromElement(e){var t=document.getElementsByTagName("*");for(segs=[];e&&e.nodeType==1;e=e.parentNode){if(e.hasAttribute("id")){var n=0;for(var o=0;o<t.length;o++){if(t[o].hasAttribute("id")&&t[o].id==e.id)n++;if(n>1)break}if(n==1){segs.unshift('id("'+e.getAttribute("id")+'")');return segs.join("/")}else{segs.unshift(e.localName.toLowerCase()+'[@id="'+e.getAttribute("id")+'"]')}}else if(e.hasAttribute("class")){segs.unshift(e.localName.toLowerCase()+'[@class="'+e.getAttribute("class")+'"]')}else{for(i=1,sib=e.previousSibling;sib;sib=sib.previousSibling){if(sib.localName==e.localName)i++}segs.unshift(e.localName.toLowerCase()+"["+i+"]")}}return segs.length?"/"+segs.join("/"):null}function highlightUrls(e){var t=/(\s|"|'|^)((?:(?:http|https|ftp|ftps|mailto):\/\/)?)((?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*\.(?:рф|com|aero|biz|com|coop|edu|eu|gov|info|int|mil|museum|name|net|org|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|travel|xxx|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)(?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*)/gim;return stripBrackets(e).replace(t,function(e,t,i,n){if(!i){i="http://"}var o=document.domain;o=o.replace("www.","");if(n.indexOf(o,0)==-1){var r="_blank"}else{var r="col_old_page"}return t+"<a href='"+i+n+"' target='"+r+"'>"+n+"</a>"})}function nl2br(e){return e.replace(/\n/g,"<br />")}function stripBrackets(e){if(underscore.isUndefined(e))return"";else return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var CLASS_LIST_SUPPORTED="classList"in document.documentElement;function splitClasses(e){return underscore.isArray(e)?e:e.replace(/^\s+|\s+$/g,"").split(/\s+/)}function forseRedraw(e){e.offsetHeight}function getClasses(e){return splitClasses(e.className)}function setClasses(e,t){var i=t.join(" ");if(e.className!==i){e.className=i;forseRedraw(e)}}var hasClass=CLASS_LIST_SUPPORTED?function t(e,i){return e.classList.contains(i)}:function n(e,t){return e.className!==""&&underscore.contains(getClasses(e),t)};var addClass=CLASS_LIST_SUPPORTED?function o(e,t){underscore.each(splitClasses(t),function(t){e.classList.add(t)});forseRedraw(e)}:function r(e,t){var i=getClasses(e),n=underscore.union(i,splitClasses(t));setClasses(e,n)};var removeClass=CLASS_LIST_SUPPORTED?function a(e,t){underscore.each(splitClasses(t),function(t){e.classList.remove(t)});forseRedraw(e)}:function s(e,t){var i=getClasses(e),n=underscore.difference(i,splitClasses(t));setClasses(e,n)};var toggleClass=CLASS_LIST_SUPPORTED?function c(e,t,i){t=underscore.uniq(splitClasses(t));underscore.each(t,function(t){e.classList.toggle(t,i)});forseRedraw(e)}:function l(e,t,i){var n=getClasses(e),o=[],r=[],a;underscore.each(splitClasses(t),function(e){var t=underscore.contains(n,e)?i!==true&&r:i!==false&&o;if(t){t.push(e)}});a=underscore.union(underscore.difference(n,r),o);setClasses(e,a)};function removeProperty(e,t){if(e.style.removeProperty)e.style.removeProperty(t);else e.style.removeAttribute(t)}function removeElement(e){e.parentNode.removeChild(e)}function prefixedEvent(e,t,i){var n=["webkit","moz","MS","o",""];for(var o=0;o<n.length;o++){if(!n[o])t=t.toLowerCase();e.addEventListener(n[o]+t,i,false)}}function switchClasses(e,t,i){removeClass(e,t);addClass(e,i)}function getOffsetRect(e){var t=e.getBoundingClientRect();var i=document.body;var n=document.documentElement;var o=window.pageYOffset||n.scrollTop||i.scrollTop;var r=window.pageXOffset||n.scrollLeft||i.scrollLeft;var a=n.clientTop||i.clientTop||0;var s=n.clientLeft||i.clientLeft||0;var c=t.top+o-a;var l=t.left+r-s;return{top:Math.round(c),left:Math.round(l)}}function getElementPosition(e){function t(e){return e.compatMode&&e.compatMode!="BackCompat"?e.documentElement:e.body}var i=e.ownerDocument,n=i.all&&!window.opera,o=n?t(i):i.defaultView||i.parentWindow,r={left:0,top:0},a;if(e.getBoundingClientRect){r=underscore.extend(r,e.getBoundingClientRect())}else{a=e;while(a){r.left+=a.offsetLeft;r.top+=a.offsetTop;a=a.offsetParent}}r.width=e.offsetWidth;r.height=e.offsetHeight;r.windowWidth=n?o.clientWidth:o.innerWidth;r.windowHeight=n?o.clientHeight:o.innerHeight;return r}function setElementPosition(e,t){e.style.cssText+=""+"; top: "+t.top+"px"+"; left : "+t.left+"px"+"; width : "+t.width+"px"+"; height: "+t.height+"px";return this}function getURLParam(e,t){var i=(t||window.location||"").search.substring(1);var n=i.split("&");for(var o=0;o<n.length;o++){var r=n[o].split("=");if(r[0]==e){return decodeURIComponent(r[1])}}}function getByIdFromParent(e){var t=window.parent.document,i=t.getElementById(e);return i&&$(i)}var utils={showAd:function(){return!(config.options&8&&config.hide_ad)
},hideOffline:function(){return config.hide_offline>0&&config.options&512}};(function(e){if(e.browser)return;e.browser={};e.browser.mozilla=false;e.browser.webkit=false;e.browser.opera=false;e.browser.msie=false;var t=navigator.userAgent;e.browser.ua=t;e.browser.name=navigator.appName;e.browser.fV=""+parseFloat(navigator.appVersion);e.browser.mV=parseInt(navigator.appVersion,10);var i,n,o;if((n=t.indexOf("Opera"))!=-1){e.browser.opera=true;e.browser.name="Opera";e.browser.fV=t.substring(n+6);if((n=t.indexOf("Version"))!=-1)e.browser.fV=t.substring(n+8)}else if((n=t.indexOf("MSIE"))!=-1){e.browser.msie=true;e.browser.name="Microsoft Internet Explorer";e.browser.fV=t.substring(n+5)}else if(t.indexOf("Trident")!=-1){e.browser.msie=true;e.browser.name="Microsoft Internet Explorer";var r=t.indexOf("rv:")+3;var a=r+4;e.browser.fV=t.substring(r,a)}else if((n=t.indexOf("Chrome"))!=-1){e.browser.webkit=true;e.browser.name="Chrome";e.browser.fV=t.substring(n+7)}else if((n=t.indexOf("Safari"))!=-1){e.browser.webkit=true;e.browser.name="Safari";e.browser.fV=t.substring(n+7);if((n=t.indexOf("Version"))!=-1)e.browser.fV=t.substring(n+8)}else if((n=t.indexOf("AppleWebkit"))!=-1){e.browser.webkit=true;e.browser.name="Safari";e.browser.fV=t.substring(n+7);if((n=t.indexOf("Version"))!=-1)e.browser.fV=t.substring(n+8)}else if((n=t.indexOf("Firefox"))!=-1){e.browser.mozilla=true;e.browser.name="Firefox";e.browser.fV=t.substring(n+8)}else if((i=t.lastIndexOf(" ")+1)<(n=t.lastIndexOf("/"))){e.browser.name=t.substring(i,n);e.browser.fV=t.substring(n+1);if(e.browser.name.toLowerCase()==e.browser.name.toUpperCase()){e.browser.name=navigator.appName}}if((o=e.browser.fV.indexOf(";"))!=-1)e.browser.fV=e.browser.fV.substring(0,o);if((o=e.browser.fV.indexOf(" "))!=-1)e.browser.fV=e.browser.fV.substring(0,o);e.browser.mV=parseInt(""+e.browser.fV,10);if(isNaN(e.browser.mV)){e.browser.fV=""+parseFloat(navigator.appVersion);e.browser.mV=parseInt(navigator.appVersion,10)}e.browser.version=e.browser.mV})(utils);function hexToR(e){return parseInt(cutHex(e).substring(0,2),16)}function hexToG(e){return parseInt(cutHex(e).substring(2,4),16)}function hexToB(e){return parseInt(cutHex(e).substring(4,6),16)}function cutHex(e){return e.charAt(0)=="#"?e.substring(1,7):e}function rgbToHex(e,t,i){return toHex(e)+toHex(t)+toHex(i)}function toHex(e){e=parseInt(e,10);if(isNaN(e))return"00";e=Math.max(0,Math.min(e,255));return"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16)}function adjustLightness(e,t,i){var n=hexToR(e);var o=hexToG(e);var r=hexToB(e);log("r="+n+" g="+o+" b="+r);var a=ColorConverter.toHSV(new RGB(n,o,r));if(a.v>0)a.v=a.v*t;else a.v=100*(t-1);a.s=a.s*i;var s=ColorConverter.toRGB(a);var c=rgbToHex(s.r,s.g,s.b);return"#"+c}function getLightness(e){var t=hexToR(e);var i=hexToG(e);var n=hexToB(e);var o=ColorConverter.toHSV(new RGB(t,i,n));log("hsv.v="+o.v);return o.v}function isLightColor(e){return getLightness(e)>65}function HSV(e,t,i){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(e>360){e=360}if(t>100){t=100}if(i>100){i=100}this.h=e;this.s=t;this.v=i}function RGB(e,t,i){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(e>255){e=255}if(t>255){t=255}if(i>255){i=255}this.r=e;this.g=t;this.b=i}function CMYK(e,t,i,n){if(e<=0){e=0}if(t<=0){t=0}if(i<=0){i=0}if(n<=0){n=0}if(e>100){e=100}if(t>100){t=100}if(i>100){i=100}if(n>100){n=100}this.c=e;this.m=t;this.y=i;this.k=n}var ColorConverter={_RGBtoHSV:function(e){var t=new HSV(0,0,0);var i=e.r/255;var n=e.g/255;var o=e.b/255;var r=Math.min(i,n,o);var a=Math.max(i,n,o);var s=a-r;t.v=a;if(s==0){t.h=0;t.s=0}else{t.s=s/a;var c=((a-i)/6+s/2)/s;var l=((a-n)/6+s/2)/s;var u=((a-o)/6+s/2)/s;if(i==a){t.h=u-l}else if(n==a){t.h=1/3+c-u}else if(o==a){t.h=2/3+l-c}if(t.h<0){t.h+=1}if(t.h>1){t.h-=1}}t.h=Math.round(t.h*360);t.s=Math.round(t.s*100);t.v=Math.round(t.v*100);return t},_HSVtoRGB:function(e){var t=new RGB(0,0,0);var i=e.h/360;var n=e.s/100;var o=e.v/100;if(n==0){t.r=o*255;t.g=o*255;t.b=o*255}else{var r=i*6;var a=Math.floor(r);var s=o*(1-n);var c=o*(1-n*(r-a));var l=o*(1-n*(1-(r-a)));if(a==0){var_r=o;var_g=l;var_b=s}else if(a==1){var_r=c;var_g=o;var_b=s}else if(a==2){var_r=s;var_g=o;var_b=l}else if(a==3){var_r=s;var_g=c;var_b=o}else if(a==4){var_r=l;var_g=s;var_b=o}else{var_r=o;var_g=s;var_b=c}t.r=var_r*255;t.g=var_g*255;t.b=var_b*255;t.r=Math.round(t.r);t.g=Math.round(t.g);t.b=Math.round(t.b)}return t},_CMYKtoRGB:function(e){var t=new RGB(0,0,0);var i=e.c/100;var n=e.m/100;var o=e.y/100;var r=e.k/100;t.r=1-Math.min(1,i*(1-r)+r);t.g=1-Math.min(1,n*(1-r)+r);t.b=1-Math.min(1,o*(1-r)+r);t.r=Math.round(t.r*255);t.g=Math.round(t.g*255);t.b=Math.round(t.b*255);return t},_RGBtoCMYK:function(e){var t=new CMYK(0,0,0,0);var i=e.r/255;var n=e.g/255;var o=e.b/255;t.k=Math.min(1-i,1-n,1-o);t.c=(1-i-t.k)/(1-t.k);t.m=(1-n-t.k)/(1-t.k);t.y=(1-o-t.k)/(1-t.k);t.c=Math.round(t.c*100);t.m=Math.round(t.m*100);t.y=Math.round(t.y*100);t.k=Math.round(t.k*100);return t},toRGB:function(e){if(e instanceof RGB){return e}if(e instanceof HSV){return this._HSVtoRGB(e)}if(e instanceof CMYK){return this._CMYKtoRGB(e)}},toHSV:function(e){if(e instanceof HSV){return e}if(e instanceof RGB){return this._RGBtoHSV(e)}if(e instanceof CMYK){return this._RGBtoHSV(this._CMYKtoRGB(e))}},toCMYK:function(e){if(e instanceof CMYK){return e}if(e instanceof RGB){return this._RGBtoCMYK(e)}if(e instanceof HSV){return this._RGBtoCMYK(this._HSVtoRGB(e))}}};machina.on("newfsm",function(e){e.on("handling",function(e){log(this.namespace+": handling "+e.inputType+" in state "+this.state)});e.on("nohandler",function(e){log(this.namespace+": unhandled "+e.inputType+" in state "+this.state)});e.on("transition",function(e){log([this.namespace+":","transition from:",e.fromState,"to:",e.toState,"action:",e.action].join(" "))})});var TimeMachine=machina.Fsm.extend({_fireEvent:function(e){delete this._scheduled_events[e];this.handle(e)},_scheduleEvent:function(e,t){if(!(e in this._scheduled_events)){log(this.namespace+": scheduling "+e+" for "+t);this._scheduled_events[e]=setTimeout(underscore.bind(this._fireEvent,this,e),t)}else{log(this.namespace+": attempt to re-schedule event"+e)}},_cancelEvent:function(e){if(e in this._scheduled_events){clearTimeout(this._scheduled_events[e]);delete this._scheduled_events[e]}else{log(this.namespace+": attempt to cancel not scheduled event",e)}},constructor:function(){this._scheduled_events={};machina.Fsm.apply(this,arguments)}});var Jivo={};Jivo.Base=function(){};Jivo.Base.extend=function(e,t){var i=this;var n;if(e&&underscore.has(e,"constructor")){n=e.constructor}else{n=function(){return i.apply(this,arguments)}}underscore.extend(n,i,t);var o=function(){this.constructor=n};o.prototype=i.prototype;n.prototype=new o;if(e)underscore.extend(n.prototype,e);n.__super__=i.prototype;return n};Jivo.Rule=Jivo.Base.extend({execute:function(){var e=this.apply();if(e){for(var t=0;t<this.commands.length;t++){log('AUTO ACTION: executing command "'+this.commands[t].name+'"');this.commands[t].execute()}}return e},apply:function(){for(var e=0;e<this.conditions.length;e++){var t=this.conditions[e].apply();if(t&&this.type==Jivo.Rule.TYPE_ANY_CONDITION){return true}if(!t&&this.type==Jivo.Rule.TYPE_ALL_CONDITION){return false}}return this.type==Jivo.Rule.TYPE_ALL_CONDITION},constructor:function(e,t){this.name=e.name;this.type=e.type;this.enabled=!!e.enabled;this.manager=t;this.conditions=[];for(var i=0;i<e.conditions.length;i++){this.conditions.push(Jivo.Condition.fabric(e.conditions[i].condition,this,e.conditions[i].comparator,e.conditions[i].value))}this.commands=[];for(var i=0;i<e.commands.length;i++){this.commands.push(Jivo.Command.fabric(e.commands[i].command,this,e.commands[i].params))}}},{TYPE_ANY_CONDITION:"any",TYPE_ALL_CONDITION:"all"});Jivo.RuleManager=Jivo.Base.extend({firstMessageTime:null,geoLoading:false,proactiveCanceled:false,canceled:false,getRules:function(e){return this.rules},execute:function(){if(!this.canceled){for(var e=0;e<this.rules.length;e++){if(this.rules[e].enabled){log('AUTO ACTIONS: executing rule "'+this.rules[e].name+'"');if(this.rules[e].execute()){this.rules.splice(e,1)}}}if(this.rules.length>0){setTimeout(underscore.bind(this.execute,this),1e3)}}},ready:function(){this.execute();if(typeof this.readyCallback==="function"){this.readyCallback()}},constructor:function(e,t){this.rules=[];this.readyCallback=t;this.pageEnterTime=(new Date).getTime();this.closeTime=cookie("close_time");this.invitationTime=cookie("invitation_time");this.pagesCount=cookie("pages_count");if(!this.pagesCount){this.pagesCount=0}cookie("pages_count",++this.pagesCount);this.siteEnterTime=cookie("site_enter_time");if(this.siteEnterTime===null){this.siteEnterTime=(new Date).getTime();cookie("site_enter_time",this.siteEnterTime)}jivo.on("handling",underscore.bind(this.onJivoHandling,this));var i,n;for(var o=0;o<e.length;o++){i=e[o];for(var r=0;r<i.conditions.length;r++){n=i.conditions[r];if(n.condition==="country"||n.condition==="city"){this.requestGeo();break}}this.rules.push(new Jivo.Rule(i,this))}if(!this.geoLoading){this.ready()}},getTimeOnPage:function(){var e=(new Date).getTime();return Math.round((e-this.pageEnterTime)/1e3)},getTimeOnSite:function(){var e=(new Date).getTime();return Math.round((e-this.siteEnterTime)/1e3)},getTimeAfterClose:function(){var e=(new Date).getTime();return this.closeTime==null?Number.MAX_VALUE:Math.round((e-this.closeTime)/1e3)},getTimeAfterFirstMessage:function(){var e=(new Date).getTime();return this.firstMessageTime!==null?Math.round((e-this.firstMessageTime)/1e3):NaN},getTimeAfterInvitation:function(){var e=(new Date).getTime();return this.invitationTime==null?Number.MAX_VALUE:Math.round((e-this.invitationTime)/1e3)},getPagesCount:function(){return this.pagesCount},requestGeo:function(){if(cookie("country")===null||cookie("city")===null){this.geoLoading=true;var e=config.base_url+"/script/geo?cb=?";getJSONP(e,underscore.bind(this.onGeoData,this))}},onGeoData:function(e){this.geoLoading=false;cookie("country",e.country,{expires:1});cookie("city",e.city,{expires:1});this.ready()},onJivoHandling:function(e){if(e.inputType==="gui_minimize"){cookie("close_time",(new Date).getTime())}else if(e.inputType==="gui_message"&&this.firstMessageTime===null){this.firstMessageTime=(new Date).getTime()}else if(e.inputType==="accept"){this.canceled=true}else if(e.inputType==="gui_maximize"&&config.contacts_required){this.proactiveCanceled=true}else if(e.inputType==="invitation"){cookie("invitation_time",(new Date).getTime())}}},{toClassName:function(e){var t=e.split("_");for(var i=0;i<t.length;i++){t[i]=t[i].charAt(0).toUpperCase()+t[i].slice(1)}return t.join("")}});Jivo.Command=Jivo.Base.extend({execute:function(){},constructor:function(e,t){this.rule=e;if(t){this.params=t}}},{fabric:function(e,t,i){return new(Jivo.Command[Jivo.RuleManager.toClassName(e)])(t,i)}});Jivo.Comparator=Jivo.Base.extend({execute:function(e,t){return false}},{fabric:function(e){return new(Jivo.Comparator[Jivo.RuleManager.toClassName(e)])}});Jivo.Condition=Jivo.Base.extend({apply:function(){var e=this.comparator.execute(this.getValue(),this.compareValue);log("AUTO ACTIONS: condition - "+this.name+", comparator - "+this.comparator.name+", actual value - "+this.getValue()+", expected value - "+this.compareValue+", result - "+e);return e},getValue:function(){return null},constructor:function(e,t,i){this.rule=e;if(!t){t="equal"}this.comparator=Jivo.Comparator.fabric(t);this.compareValue=i}},{fabric:function(e,t,i,n){return new(Jivo.Condition[Jivo.RuleManager.toClassName(e)])(t,i,n)}});Jivo.Command.OpenOffline=Jivo.Command.extend({name:"open_offline",params:{title:"",message:""},execute:function(){cookie("invitation_time",(new Date).getTime());if(this.params.title){config.offline_widget_label=this.params.title}if(this.params.message){config.offline_form_text=this.params.message}setTimeout(underscore.bind(function(){if(!jivo.isMobile()){jivo.handle("gui_maximize")}},this),0)}});Jivo.Command.Proactive=Jivo.Command.extend({name:"proactive",constructor:function(e,t){this.rule=e;this.params=t;jivo.on("handling",underscore.bind(function(e){if(e.inputType==="gui_message"){this.rule.manager.proactiveCanceled=true}},this))},execute:function(){if(!this.rule.manager.proactiveCanceled){this.rule.manager.proactiveCanceled=true;var e=this.restoreAgentInfo();var t={};if(e){t.agent_id=e.agent_id}if(this.params.department&&config.departments&&this.hasDepartment(this.params.department)){t.department=this.params.department}getJSONPWithData(config.base_url+"/script/active-agent/"+config.widget_id,t,underscore.bind(this.showProactive,this))}},hasDepartment:function(e){for(var t in config.departments){if(config.departments[t].id==e){return true}}return false},showProactive:function(e){if(!e){return}jivo.handle("invitation",e,{name:this.rule.name,invitationText:this.params.message})},restoreAgentInfo:function(){var e=cookie("agent_info");if(e){var t=e.split("$$");return{agent_id:t[0]}}return false}});Jivo.Command.Hide=Jivo.Command.extend({name:"hide",execute:function(){jivo.handle("hide")}});Jivo.Command.SystemMessage=Jivo.Command.extend({name:"system_message",execute:function(){jivo.handle("system_message",{message:this.params.message})}});Jivo.Comparator.Contain=Jivo.Comparator.extend({name:"contain",execute:function(e,t){return e.toLowerCase().indexOf(t.toLowerCase())!=-1}});Jivo.Comparator.Equal=Jivo.Comparator.extend({name:"equal",execute:function(e,t){return e==t}});Jivo.Comparator.Greater=Jivo.Comparator.extend({name:"greater",execute:function(e,t){return e>t}});Jivo.Comparator.GreaterEqual=Jivo.Comparator.extend({name:"greater_equal",execute:function(e,t){return e>=t}});Jivo.Comparator.Lower=Jivo.Comparator.extend({name:"lower",execute:function(e,t){return e<t}});Jivo.Comparator.LowerEqual=Jivo.Comparator.extend({name:"lower_equal",execute:function(e,t){return e<=t}});Jivo.Comparator.NotContain=Jivo.Comparator.extend({name:"not_contain",execute:function(e,t){return e.toLowerCase().indexOf(t.toLowerCase())===-1}});Jivo.Comparator.NotEqual=Jivo.Comparator.extend({name:"not_equal",execute:function(e,t){return e!=t}});Jivo.Comparator.Regexp=Jivo.Comparator.extend({name:"regexp",execute:function(e,t){var i=new RegExp(t,"i");return i.test(e)}});Jivo.Condition.PageTitle=Jivo.Condition.extend({name:"page_title",getValue:function(){return document.title}});Jivo.Condition.PageUrl=Jivo.Condition.extend({name:"page_url",getValue:function(){return document.location.href}});Jivo.Condition.PagesCount=Jivo.Condition.extend({name:"pages_count",getValue:function(){return this.rule.manager.getPagesCount()}});Jivo.Condition.TimeOnPage=Jivo.Condition.extend({name:"time_on_page",getValue:function(){return this.rule.manager.getTimeOnPage()}});Jivo.Condition.TimeOnSite=Jivo.Condition.extend({name:"time_on_site",getValue:function(){return this.rule.manager.getTimeOnSite()}});Jivo.Condition.TimeAfterClose=Jivo.Condition.extend({name:"time_after_close",getValue:function(){return this.rule.manager.getTimeAfterClose()}});Jivo.Condition.TimeAfterFirstMessage=Jivo.Condition.extend({name:"time_after_first_message",getValue:function(){return this.rule.manager.getTimeAfterFirstMessage()}});Jivo.Condition.TimeAfterInvitation=Jivo.Condition.extend({name:"time_after_invitation",getValue:function(){return this.rule.manager.getTimeAfterInvitation()}});Jivo.Condition.Hour=Jivo.Condition.extend({name:"hour",getValue:function(){return(new Date).getHours()}});Jivo.Condition.WeekDay=Jivo.Condition.extend({name:"week_day",getValue:function(){return(new Date).getDay()}});Jivo.Condition.Country=Jivo.Condition.extend({name:"country",getValue:function(){return cookie("country")}});Jivo.Condition.City=Jivo.Condition.extend({name:"city",getValue:function(){return cookie("city")}});Jivo.Condition.Online=Jivo.Condition.extend({name:"online",comparator:new Jivo.Comparator.Equal,getValue:function(){return config.chat_mode=="online"}});var _templates={content:underscore.template(["<!DOCTYPE html>","<html>","<head>","<meta charset='utf-8'>","<link rel='stylesheet' href='{{ cssMainUrl }}'/>","<!--[if lte IE 7]>","<link rel='stylesheet' href='{{ cssIE7Url }}' type='text/css' media='all'/>","<![endif]-->","<!--[if lte IE 8]>","<link rel='stylesheet' href='{{ cssIE8Url }}' type='text/css' media='all'/>","<![endif]-->",'<script type="text/javascript" src="//cdn.voximplant.com/voximplant.min.js"></script>',"<title>{{ title }}</title>","</head>","<body id='inner-chat'>","<div id='web_phone' class='phone_hidden'>","<div id='rtc_placeholder'></div>","<div id='up_arrow'></div>","<div id='phone_hint'></div>","</div>","<div id='sound_player'></div>","<div id='contents_placeholder'></div>","<script src='{{ scriptUrl }}' charset='UTF-8'></script>","</body>","</html>"].join("\n")),chat:underscore.template(["<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-chat-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-drag-handle'></div>","<div id='jivo-mouse-tracker' style='display: none'></div>","<div id='jivo_action' class='jivo-{{ mobile }}'>","<div id='jivo_close_button' data-action='close'></div>","</div>","<div id='jivo_iframe_wrap'>","<div id='jivo_iframe_placeholder'></div>","</div>","<div class='jivo-loader' id='jivo-loader'>","<div class='jivo-loader-title' id='jivo-loader-title'>{{ lblLookingForFreeAgent }}</div>","<div class='jivo-loader-inner'></div>","</div>"].join("\n")),label:{top:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }}'></div>","<div id='jivo-label-text'>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","</div>","</div>","</div>"].join("\n")),bottom:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-text'>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-copyright' class='jivo-{{ type }}'></div>","</div>","</div>","</div>"].join("\n")),left:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }}'></div>","<div id='jivo-label-text'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n")),right:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }}'></div>","<div id='jivo-label-text'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n"))}};var JivoWidget=TimeMachine.extend({namespace:"WIDG",fade:false,position:{},initialState:"HIDDEN",initialize:function(){this._templateData={orientation:config.widget_orientation,height:config.widget_height,style:config.style_string,text:config.chat_mode=="online"?config.online_widget_label:config.offline_widget_label,type:config.widget_font_color};this._widgetDiv=document.createElement("div");this._widgetDiv.onclick=underscore.bind(this.handle,this,"click");this._widgetDiv.setAttribute("id","jivo_chat_widget");this._widgetDiv.innerHTML=_templates.label[config.widget_orientation](this._templateData);this.topWrap.appendChild(this._widgetDiv);this._el=document.getElementById("jivo-label");this.setColor();this.setFontStyle();this.setPosition()},isCustom:function(){var e=this._widgetDiv.currentStyle?this._widgetDiv.currentStyle.display:getComputedStyle(this._widgetDiv,null).display;return e=="none"},states:{VISIBLE:{_onEnter:function(){this._el.style.display="block";this._el.style.visibility="visible";if(this.fade){addClass(this._el,"jivo-fade-in")}},click:function(){jivo.handle("gui_maximize")},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){removeClass(this._el,"jivo-fade-in");this._el.style.visibility="hidden"},show:"VISIBLE",hide:function(){}}},getOffset:function(e){var t=0;var i=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;i+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{top:i,left:t}},setText:function(e){if(!this._widgetDiv||config["widget_orientation"]=="left"||config["widget_orientation"]=="right")return;var t=document.getElementById("jivo-label-text");t.innerHTML=e;this.setPosition();this.position=getElementPosition(this._el)},setColor:function(){this._containerDiv=document.getElementById("jivo-label-wrapper");this._textContainer=document.getElementById("jivo-label-text");var e=getElementsByClassName("jivo-label-triangle");for(var t=0;t<e.length;t++){switch(config.widget_orientation){case"top":e[t].style.borderTopColor=config.widget_color;break;case"bottom":e[t].style.borderLeftColor=config.widget_color;break;case"right":e[t].style.borderBottomColor=config.widget_color;break;case"left":e[t].style.borderLeftColor=config.widget_color;break}}var e=getElementsByClassName("jivo-triangle-inner");for(var t=0;t<e.length;t++){e[t].style.backgroundColor=config.widget_color}if(config.chat_mode=="offline"){var e=getElementsByClassName("jivo-bottom-left-square");for(var t=0;t<e.length;t++){e[t].style.backgroundColor=config.widget_color}}if(this._containerDiv){this._textContainer.style.fontSize=config["font_size"]+"px";this._textContainer.style.fontFamily=config["font_family"];this._isDarkText=config.widget_font_color=="dark";if(this._isDarkText){var i="#222222"}else{var i="#F0F1F1"}this._textContainer.style.color=i}},setOffline:function(){document.getElementById("jivo_chat_widget_online").setAttribute("id","jivo_chat_widget_offline");this.setText(config.offline_widget_label)},setPosition:function(){var e=getElementPosition(this._el),t=30,i=10;switch(config["widget_orientation"]){case"left":case"right":var n=document.getElementById("jivo-text-container");var o=n.getElementsByTagName("div")[0];if(o.offsetWidth<o.offsetHeight){n.style.width=o.offsetWidth+"px";n.style.height=o.offsetHeight+"px"}else{n.style.width=o.offsetHeight+"px";n.style.height=o.offsetWidth+"px"}e=getElementPosition(this._el);switch(config["widget_padding"]){case"0":t=-30;break;case"50":t=e.height/2;break;case"100":t=e.height+i;break}this._el.style.top=config.widget_padding+"%";this._el.style.marginTop=t*-1+"px";this._el.style.width=config["widget_height"]+"px";break;case"top":case"bottom":switch(config["widget_padding"]){case"0":t=-30;break;case"50":t=e.width/2;break;case"100":t=e.width+i;break}if(config.widget_padding=="100"){this._el.style.left="";this._el.style.right="30px"}else{this._el.style.left=config.widget_padding+"%";this._el.style.right="";this._el.style.marginLeft=t*-1+"px"}this._el.style.height=config["widget_height"]+"px";break}},setFontStyle:function(){var e=document.getElementById("jivo-label-text");switch(config.font_type){case"normal":e.style.fontWeight="normal";e.style.fontStyle="normal";break;case"italic":e.style.fontWeight="normal";e.style.fontStyle="italic";break;case"bold":e.style.fontWeight="bold";e.style.fontStyle="normal";break;case"bold italic":e.style.fontWeight="bold";e.style.fontStyle="italic";break}e.style.fontSize=config["font_size"]},getPosition:function(){return getElementPosition(document.getElementById("jivo-label"))}});var JivoChatTop=TimeMachine.extend({namespace:"CHAT",mode:"online",_chatDiv:0,_iframe:0,_iframeWrap:0,_doc:0,_window:0,_backgroundColor:0,_borderColor:0,_bodyColor:0,_onload_semaphore:false,_event_queue:[],_getDoc:function(){if(this._iframe.contentDocument){return this._iframe.contentDocument}else if(this._iframe.contentWindow){return this._iframe.contentWindow.document}else{log("WARNING! chat_iframe._doc is null");return 0}},iframeLoaded:function(){if(this._onload_semaphore){try{this._window.chat_contents.init(this.mode,this.open_params)}catch(e){log("CHAT: iframe loaded, but contents is unreachable");return}this.handle("iframe_ready")}else this._onload_semaphore=true},setColor:function(){this._isDarkText=config.widget_font_color=="dark";this._backgroundColor=config.widget_color;this._borderColor=adjustLightness(this._backgroundColor,.6,1);this._bodyColor=adjustLightness(this._backgroundColor,1.15,.5);var e=document.getElementById("jivo-chat");if(e){if(this._isDarkText){var t=adjustLightness(this._backgroundColor,1.15,.7)+" 0 1px";var i=adjustLightness(this._backgroundColor,.1,.5)}else{var t=adjustLightness(this._backgroundColor,.6,1)+" 0 -1px";var i="#ffffff"}document.getElementById("jivo-loader-title").style.color=i}},setChatHeight:function(e){log("Setting chat height: "+e);this._chatDiv.style.height=e+"px"},hide:function(){this._iframe.style.display="none";this._iframe.style.visibility="hidden";this._chatDiv.style.visibility="hidden";removeClass(this._chatDiv,"jivo-fade-in")},show:function(){this._iframe.style.display="block";this._iframe.style.visibility="visible";this._chatDiv.style.visibility="visible";addClass(this._chatDiv,"jivo-fade-in")},getInitPosition:function(){var e={};var t=config.widget_orientation=="top"||config.widget_orientation=="bottom";if(config.widget_orientation=="left"||t&&config.widget_padding==0){e.left="30px"}else{e.right="30px"}if(config.chat_mode=="online"){if(cookie("left")){e.left=cookie("left")}if(cookie("right")){e.right=cookie("right")}if(cookie("height")){e.height=cookie("height")}else if(config.contacts_required){e.height=this.getOnlineFormHeight()}}else{e.height=this.getOfflineFormHeight()}return e},getOfflineFormHeight:function(){var e=this.getOfflineDescriptionHeight();e+=JivoChatTop.MESSAGE_OFFLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.email.show||!config.contacts_settings.phone.show||!config.contacts_settings.phone.required){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.contacts_settings.name.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.contacts_settings.phone.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(!(config.options&8&&config.hide_ad)){e+=JivoChatTop.ADWORD_HEIGHT}e+=JivoChatTop.INNER_PADDING*2;e+=JivoChatTop.HEADER_OFFLINE_HEIGHT;e+=JivoChatTop.BUTTONS_HEIGHT;return e+"px"},getOfflineDescriptionHeight:function(){var e=document.createElement("div");e.style.position="absolute";e.style.fontSize="16px";e.style.fontFamily="Arial, sans-serif";e.style.lineHeight="19px";e.style.visibility="hidden";e.style.width="247px";e.innerHTML=config.offline_form_text;document.body.appendChild(e);var t=e.offsetHeight+JivoChatTop.DESCRIPTION_MARGIN;document.body.removeChild(e);return t},getOnlineFormHeight:function(){var e=JivoChatTop.MESSAGE_ONLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.email.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN;if(config.contacts_settings.phone.show){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(config.departments){e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN}if(!(config.options&8&&config.hide_ad)){e+=JivoChatTop.ADWORD_HEIGHT}e+=JivoChatTop.INNER_PADDING;e+=JivoChatTop.HEADER_ONLINE_HEIGHT;e+=JivoChatTop.BUTTONS_HEIGHT;e+=JivoChatTop.AVATAR_MARGIN;return Math.max(JivoChatTop.MIN_HEIGHT,e)+"px"},getPosition:function(){return getElementPosition(this._chatDiv)},initialize:function(){this._chatDiv=document.createElement("div");this._chatDiv.setAttribute("id","jivo-chat");var e=this.getInitPosition();for(var t in e){this._chatDiv.style[t]=e[t]}var i="mobile";this._chatDiv.innerHTML=_templates.chat({chatMode:config.chat_mode,mobile:"desktop",lblLookingForFreeAgent:translate("lblLookingForFreeAgent")});this.topWrap.appendChild(this._chatDiv);this.setColor();var n=getElementsByClassName("jivo-chat-triangle");for(var t=0;t<n.length;t++){n[t].style.borderLeftColor=config.widget_color}var n=getElementsByClassName("jivo-triangle-inner");for(var t=0;t<n.length;t++){n[t].style.backgroundColor=config.widget_color}if(config.chat_mode=="offline"){var n=getElementsByClassName("jivo-bottom-left-square");for(var t=0;t<n.length;t++){n[t].style.backgroundColor=config.widget_color}}},states:{uninitialized:{show:function(e,t){this.mode=e;this.open_params=t;this.transition("LOADING_IFRAME")},resume_ok:function(){this._event_queue.push(["resume_ok"].concat(underscore.toArray(arguments)));this.mode="online";this.transition("LOADING_IFRAME")},invitation:function(e,t){this._event_queue.push(["accept",{agent_info:e}]);this._event_queue.push(["agent_message",{message:t}]);this.mode="online";this.transition("LOADING_IFRAME")}},LOADING_IFRAME:{_onEnter:function(){this._chatDiv.style.visibility="visible";addClass(this._chatDiv,"jivo-fade-in");this._iframe=document.createElement("iframe");this._iframe.setAttribute("id","jivo_chat_iframe");this._iframe.setAttribute("frameBorder","0");this._iframe.setAttribute("scrolling","no");this._iframe.allowTransparency=true;this._iframe.style.visibility="hidden";
this._iframeWrap=document.getElementById("jivo_iframe_placeholder");this._iframeWrap.appendChild(this._iframe);setIframeLoadCallback(this._iframe,underscore.bind(this.iframeLoaded,this));this._doc=this._getDoc();this._doc.open();var e={cssMainUrl:config.base_url+"/css/chat.css?rnd=100530",cssIE7Url:config.base_url+"/css/chat-ie7.css?rnd=100530",cssIE8Url:config.base_url+"/css/chat-ie8.css?rnd=100530",title:window.document.title,lblPhoneHint:translate("lblPhoneHint"),scriptUrl:config.base_url+"/js/chat_"+config.locale+".js?rnd=100530"};this._doc.write(_templates.content(e));this._doc.close();this._window=this._iframe.contentWindow;this.iframeLoaded();addClass(this._chatDiv,"jivo-animated jivo-"+config.chat_mode)},iframe_ready:function(){delete this.open_params;if(jivo.gui.animationIsSupported()){addClass(document.getElementById("jivo-loader"),"jivo-fade-out");addClass(this._iframe,"jivo-fade-in")}else{document.getElementById("jivo-loader").style.display="none"}var e;while(e=this._event_queue.shift()){this._window.chat_contents.handle.apply(this._window.chat_contents,e)}this.transition("VISIBLE")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._event_queue.push(underscore.toArray(arguments));this.mode="online"},invitation:function(e,t){this._event_queue.push(["accept",{agent_info:e}]);this._event_queue.push(["agent_message",{message:t}]);this.mode="online"}},VISIBLE:{_onEnter:function(){this.show()},hide:function(){this.transition("HIDDEN")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e});this._window.chat_contents.handle("agent_message",{message:t})}},HIDDEN:{_onEnter:function(){this.hide()},show:function(e){this.transition("VISIBLE");this._window.chat_contents.handle("maximized",e)},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e});this._window.chat_contents.handle("agent_message",{message:t});this.transition("VISIBLE")},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))}}}},{INPUT_MARGIN:10,INPUT_HEIGTH:30,MESSAGE_OFFLINE_HEIGHT:109,BUTTONS_HEIGHT:28,HEADER_OFFLINE_HEIGHT:60,INNER_PADDING:10,ADWORD_HEIGHT:30,MESSAGE_ONLINE_HEIGHT:84,HEADER_ONLINE_HEIGHT:75,AVATAR_MARGIN:20,MIN_HEIGHT:372,DESCRIPTION_MARGIN:20});var JivoGui=TimeMachine.extend({namespace:"GUI",mode:"online",animate:false,unreadMessages:0,_event_queue:[],setOnline:function(){this.mode="online";return this},setOffline:function(){if(this.mode!="offline"){this._setButtonsOffline();this.widget.setOffline();this.mode="offline"}return this},showWidget:function(e){this.enableAnimation(!!e);this.handle("minimize");return this},showChat:function(e,t){if(jivo.isMobile()){this.openNewWindow()}else{this.enableAnimation(!!e);this.handle("maximize",t)}return this},showInvitation:function(e,t){this.handle("invitation",e,t);return this},openNewWindow:function(){var e="http:"+jivo_config.base_url+"/script/window/"+jivo_config.widget_id;var t=[];var i=["client_id"];if(jivo_config.chat_mode=="online"){i.push("sess_id")}for(var n=0;n<i.length;n++){if(cookie(i[n])){t.push(i[n]+"="+cookie(i[n]))}}var o=jivo.getCurrentPage();t.push("url="+encodeURIComponent(o.url));t.push("title="+encodeURIComponent(o.title));if(t.length){e+="?"+t.join("&")}window.location=e},getChatTop:function(){if(!this.chat_top){this.chat_top=new JivoChatTop({topWrap:this._wrapDiv})}return this.chat_top},chatInitialized:function(){return!!this.chat_top},incrementCounter:function(){var e=document.getElementById("jivo-label-indicator");e.innerHTML=++this.unreadMessages;e.style.visibility="visible"},resetCounter:function(){var e=document.getElementById("jivo-label-indicator");this.unreadMessages=0;e.style.visibility="hidden"},_setButtonsOffline:function(){var e=false;var t=getElementsByClassName("jivo-btn jivo-online-btn");for(var i=0;i<t.length;i++){if(!e){e=t[i].style.display}t[i].style.display="none"}t=getElementsByClassName("jivo-btn jivo-offline-btn");for(i=0;i<t.length;i++){t[i].style.display=e}},highlight:function(e){var t=config.base_url+"/script/cobrowsing?cb=?&hash="+e;getJSONP(t,function(e){if(underscore.isObject(e)){if(e.comment.length==0)e.comment=translate("lblDefaultCobrowseComment");e.comment=stripBrackets(e.comment);childSandboxBridge.process("highlight",e);childSandboxBridge.process("renderTooltip",e)}})},initialize:function(){this._wrapDiv=document.createElement("div");this._wrapDiv.setAttribute("id","jivo_top_wrap");document.body.appendChild(this._wrapDiv);underscore.defaults(config,{online_widget_label:translate("defOnlineWidgetLabel"),offline_widget_label:translate("defOfflineWidgetLabel"),offline_form_text:translate("defOfflineFormText"),contacts_settings:{name:{show:false,required:false},phone:{show:false,required:false},email:{show:false,required:false}}});if(jivo.isMobile()){config.online_widget_label=translate("defOnlineWidgetLabelMobile")||config.online_widget_label;config.offline_widget_label=translate("defOfflineWidgetLabelMobile")||config.offline_widget_label;config.widget_orientation="bottom";config.widget_padding=100}this.widget=new JivoWidget({topWrap:this._wrapDiv});this.copyright=new JivoCopyright;if(this.animationIsSupported()){this.phantom=new JivoPhantom({topWrap:this._wrapDiv});this.phantom.on("animated",underscore.bind(this.handle,this,"animate_finished"))}},enableAnimation:function(e){if(e){log("GUI : enabling animation");this.animate=true}else{log("GUI : disabling animation");this.animate=false}},animationIsSupported:function(){if(!this.widget.isCustom()){var e=utils.browser;if(e.name=="Firefox"&&e.mV>23){return true}else if(e.name=="Chrome"&&e.mV>28){return true}else if(e.name=="Safari"&&e.mV>5){return true}}return false},states:{uninitialized:{minimize:"WIDGET",maximize:function(){this._event_queue.push(["show",this.mode]);this.transition("CHAT")},blacklist:"INVISIBLE",resume_ok:function(){this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)));this.transition("CHAT")}},WIDGET:{_onEnter:function(){if(this.chatInitialized()){this.getChatTop().handle("hide")}this.widget.handle("show")},maximize:function(e){this.resetCounter();this._event_queue.push(["show",this.mode,e]);if(this.animationIsSupported()&&this.animate){this.transition("ANIMATE_EXPAND")}else{this.transition("CHAT")}},"*":function(e){if(!jivo.isMobile()){if(e!="invitation"){this._event_queue.push(["show",this.mode])}this._event_queue.push(underscore.toArray(arguments));if(underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0){this.transition(this.animationIsSupported()?"ANIMATE_EXPAND":"CHAT")}else if(e=="resume_ok"){this.transition("CHAT")}}else if(underscore.indexOf(["agent_message","system_message","invitation","agent_service_message"],e)>=0){if(underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0){this.incrementCounter()}}},blacklist:function(){this.widget.handle("hide");this.transition("INVISIBLE")}},CHAT:{_onEnter:function(){this.widget.handle("hide");var e;while(e=this._event_queue.shift()){this.getChatTop().handle.apply(this.getChatTop(),e)}if(!this.widget.fade){this.widget.fade=true}},minimize:function(){if(this.animationIsSupported()&&this.animate){this.transition("ANIMATE_COLLAPSE")}else{this.transition("WIDGET")}},"*":function(){this.getChatTop().handle.apply(this.getChatTop(),underscore.toArray(arguments))},blacklist:function(){this.getChatTop().handle("hide")}},ANIMATE_EXPAND:{_onEnter:function(){this.phantom.handle("expand",this.widget.getPosition(),this.getChatTop().getPosition());this.widget.handle("hide")},animate_finished:"CHAT",resume_ok:function(){this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)))},blacklist:"INVISIBLE"},ANIMATE_COLLAPSE:{_onEnter:function(){this.phantom.handle("collapse",this.widget.getPosition(),this.getChatTop().getPosition());this.getChatTop().hide()},animate_finished:"WIDGET",blacklist:"INVISIBLE"},INVISIBLE:{animate_finished:function(){this.widget.handle("hide");this.getChatTop().handle("hide")}}}});var JivoCopyright=TimeMachine.extend({namespace:"AD",initialState:"HIDDEN",disabled:false,initialize:function(){var e=document.getElementById("jivo-label-copyright");if(!utils.showAd()){addClass(e,"jivo-no-copyright");this.disabled=true;return}this.jivo_copyright=document.getElementById("jivo_copyright");if(!this.jivo_copyright){this.jivo_copyright=document.createElement("div");var t="com";if(underscore.indexOf(["ru_RU","be","kk","uk"],config.locale)>=0){t="ru"}this.jivo_copyright.innerHTML=translate("seo_copyrightTextNew").replace("_JIVOSITE_","<a href='http://jivosite."+t+"' target='_blank' id='jivosite-copyright' class='jivo-"+config.widget_font_color+"'></a>");this.jivo_copyright.id="jivo_copyright";this.jivo_copyright.style.display="none";document.body.appendChild(this.jivo_copyright)}var i=document.createElement("div");i.setAttribute("id","jivo_copyright_corner");i.setAttribute("class","jivo-"+config.widget_orientation);switch(config.widget_orientation){case"top":i.style.borderBottomColor=config.widget_color;break;case"left":i.style.borderRightColor=config.widget_color;break;case"right":i.style.borderLeftColor=config.widget_color;break;case"bottom":i.style.borderTopColor=config.widget_color;break}this.jivo_copyright.style.backgroundColor=config.widget_color;this.jivo_copyright.appendChild(i);var n=this.jivo_copyright.getElementsByTagName("a");for(var o=0;o<n.length;o++){n[o].href+="?utm_source="+encodeURIComponent(location.hostname)+"&utm_medium=link&utm_content=widget_popup&utm_campaign=self_ad"}if(!jivo.isMobile()){e.onmouseover=underscore.bind(this.handle,this,"ad_mouseover");e.onmouseout=underscore.bind(this.handle,this,"ad_mouseout");this.jivo_copyright.onmouseover=underscore.bind(this.handle,this,"copyright_mouseover");this.jivo_copyright.onmouseout=underscore.bind(this.handle,this,"copyright_mouseout")}},getTooltipPosition:function(e){var t=getElementPosition(e),i=getElementPosition(document.getElementById("jivo_copyright")),n={top:0,left:0};switch(config["widget_orientation"]){case"left":n={top:t.top+10,left:t.left+t.width+10};if(ie8){n={top:t.top,left:t.left+t.width+10}}break;case"right":n={top:t.top+10,left:t.left-i.width-10};break;case"top":n={top:t.top+(t.height+15),left:t.left+40};break;case"bottom":n={bottom:t.height+10,left:t.left+(t.width-i.width)-40};break}return n},states:{HIDDEN:{_onEnter:function(){if(!this.disabled){this.jivo_copyright.style.display="none"}},ad_mouseover:"VISIBLE"},VISIBLE:{_onEnter:function(){this.jivo_copyright.style.display="block";var e=this.getTooltipPosition(document.getElementById("jivo-label"));this.jivo_copyright.style.left=e.left+"px";if(typeof e.bottom!="undefined"){this.jivo_copyright.style.bottom=e.bottom+"px"}else{this.jivo_copyright.style.top=e.top+"px"}},ad_mouseout:function(){this._scheduleEvent("hide",700)},hide:"HIDDEN",copyright_mouseover:function(){this._cancelEvent("hide")},copyright_mouseout:function(){this._scheduleEvent("hide",700)}}}});var jivoTitle=new TimeMachine({namespace:"TITLE",title:"",startBlink:function(){this.handle("start")},stopBlink:function(){this.handle("stop")},_messageShown:false,_showMessage:function(){document.title=translate("lblNewMessage");this._messageShown=true},_showTitle:function(){document.title=this.title;this._messageShown=false},states:{uninitialized:{start:"blinking"},blinking:{_onEnter:function(){this.title=document.title;this._showMessage();this._scheduleEvent("blink",1e3)},blink:function(){if(this._messageShown){this._showTitle()}else{this._showMessage()}this._scheduleEvent("blink",1e3)},stop:function(){this._showTitle();this._cancelEvent("blink");this.transition("uninitialized")}}}});var jivo=window.jivo=new TimeMachine({namespace:"JIVO",_chatWindow:false,_forcedCurrentPage:false,_forcedOffline:false,invitationText:false,agentInfo:false,ruleName:false,initialize:function(){var e=underscore.bind(this.handle,this,"window.loaded");if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir){var t=setInterval(function(){log("check for document.readyState: "+document.readyState);if(document.readyState==="complete"||document.readyState==="loaded"){jivo.handle("window.loaded");clearInterval(t)}},300);return}if(document.readyState==="complete"){setTimeout(e)}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",e,false);window.addEventListener("load",e,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",e);window.attachEvent("onload",e)}this.device=device},_changeBrowserLocation:function(e,t){if(typeof window.parent.history.pushState=="function"){window.parent.history.pushState({},t,e)}},_chatserverUrl:function(){var e=window.location.protocol+"//";if("comet"in config){e+=config.comet.host;if(window.location.protocol=="https:"){if("secure_port"in config.comet){e+=":"+config.comet.secure_port}}else{if("plain_port"in config.comet){e+=":"+config.comet.plain_port}}}else{e+="node.jivosite.com"}e+="/jsonp/";return e},_checkSession:function(e){var t=this.getCurrentPage();getJSONPWithData(this._chatserverUrl()+e,{name:"url_change",title:t.title,url:t.url},underscore.bind(this.handle,this,"check_session_response"));this.transition("CHECKING_SESSION")},_newSession:function(){cookie("sess_id",null);if(!this.isSeparateWindow()){if(config.chat_mode=="offline"){if(utils.hideOffline()){this.transition("HIDDEN");return}}if(config.options&16){this.transition("INIT_RULE_MANAGER");return}if(config.chat_mode=="online"){this.transition("ONLINE")}else{this.transition("OFFLINE")}}this.gui.showWidget()},_listenMessages:function(e){log("JIVO: listening for window messages");if("addEventListener"in window){window.addEventListener("message",underscore.bind(this._windowMessage,this,e),false)}else if("attachEvent"in window){window.attachEvent("message",underscore.bind(this._windowMessage,this,e))}},_windowMessage:function(e,t){this.handle([e,t.data.action].join("_"),t)},isMobile:function(){return device.mobile()},isTablet:function(){return device.tablet()},isSeparateWindow:function(){return typeof jivo_newWindow!="undefined"},createMagicIFrame:function(){if(!this.isMobile()&&!this.isTablet()&&!this.isSeparateWindow()){site_iframe.create()}},_callUserFunction:function(e){e="jivo_"+e;if(typeof window[e]=="function"){try{log("JIVO: calling user function "+e);window[e]();log("JIVO: user function "+e+" returned")}catch(t){}}},_saveClientInfo:function(e){underscore.each(["name","phone","email"],function(t){if(t in e){if(e[t]!=""){if(t=="name"){cookie("client_name",e[t],{expires:365,path:"/"})}else{cookie(t,e[t],{expires:365,path:"/"})}}}})},getCurrentPage:function(){if(this._forcedCurrentPage){return this._forcedCurrentPage}return{url:window.location.href,title:document.title}},getChatHeight:function(){return document.getElementById("jivo-chat").offsetHeight},_stripHashFromLocation:function(e){if(window.location.href.indexOf("#jvhs_"+e)>0){this._changeBrowserLocation(window.location.href.replace("#jvhs_"+e,""),document.title)}},_pageVisible:function(){if("visibilityState"in document){return document.visibilityState=="visible"}else if("webkitVisibilityState"in document){return document.webkitVisibilityState=="visible"}return false},_listenVisibility:function(){log("Installing visibility event handler");var e,t,i;if(typeof document.hidden!=="undefined"){e="hidden";i="visibilitychange";t="visibilityState"}else if(typeof document.mozHidden!=="undefined"){e="mozHidden";i="mozvisibilitychange";t="mozVisibilityState"}else if(typeof document.msHidden!=="undefined"){e="msHidden";i="msvisibilitychange";t="msVisibilityState"}else if(typeof document.webkitHidden!=="undefined"){e="webkitHidden";i="webkitvisibilitychange";t="webkitVisibilityState"}if("addEventListener"in document){document.addEventListener(i,underscore.bind(this._visibleHandler,this,t),false)}},_visibleHandler:function(e){this.handle("window_"+document[e])},_isBlacklisted:function(){var e=cookie("client_id");return e&&e.indexOf("z")==0},_inAir:function(){return window.parentSandboxBridge&&window.parentSandboxBridge.inAir},_sendRate:function(e,t){var i={jv_sess_id:t,r:e};getJSONPWithData(config.base_url+"/script/rate/"+config.widget_id,i,function(e){log("Rate result",e)})},handleGuiTranstion:function(e){if(e.toState=="WIDGET"){this._callUserFunction("onClose")}else if(e.toState=="CHAT"){this._callUserFunction("onOpen")}},states:{uninitialized:{"window.loaded":function(){if(this.isSeparateWindow()){var e=getURLParam("url");var t=getURLParam("title");if(e&&t){this._forcedCurrentPage={url:e,title:t}}var i=getURLParam("client_id");if(i){cookie("client_id",i)}var n=getURLParam("sess_id");config.chat_mode=n?"online":"offline";this.gui=new JivoGui;if(n){cookie("sess_id",n);this._checkSession(n)}else{this.transition("OFFLINE")}}else if(this._isBlacklisted()){this.transition("HIDDEN")}else if(this.isMobile()&&config.disable_mobile){this.transition("HIDDEN")}else{this.transition("LOADING_CSS")}}},LOADING_CSS:{_onEnter:function(){if(document.createStyleSheet){if(ie){document.createStyleSheet(config.base_url+"/css/label.css?rnd=100530")}if(ie7)document.createStyleSheet(config.base_url+"/css/label-ie7.css?rnd=100530");if(ie8)document.createStyleSheet(config.base_url+"/css/label-ie8.css?rnd=100530")}else{var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("href",config.base_url+"/css/label.css?rnd=100530");var t=utils.browser;if(t.name=="Opera"||t.name=="Safari"&&t.mV<6||t.name=="Firefox"&&t.mV<12){var i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("href",config.base_url+"/css/label-ie8.css?rnd=100530");document.body.appendChild(i)}document.body.appendChild(e)}var n=this.cssDetector=document.createElement("div");n.id="jivo_css_detector";n.style.visibility="hidden";n.style.position="absolute";document.body.appendChild(n);this._scheduleEvent("timer_css",100)},timer_css:function(){if(this.cssDetector.offsetWidth!=10){this._scheduleEvent("timer_css",100);return}this.gui=new JivoGui;try{if(this._inAir()){window.parentSandboxBridge.process("onIframeDomReady");this.transition("HIDDEN");return}}catch(e){}this.gui.on("transition",underscore.bind(this.handleGuiTranstion,this));var t=window.location.hash.split("jvhs_");if(!underscore.isUndefined(t[1])){this.gui.highlight(t[1])}if(window!=window.top){try{if(window.top.jivo_magic_var==jivo_magic_var){this.transition("IN_IFRAME");return}}catch(e){}this.transition("HIDDEN");return}if(!this.isSeparateWindow()){this._listenVisibility();this._callUserFunction("onLoadCallback")}var i=cookie("sess_id");if(i){this._checkSession(i)}else{this._newSession()}}},CHECKING_SESSION:{_onEnter:function(){this._scheduleEvent("timer_check_session",2e3)},check_session_response:function(e){log("JIVO: Check session response",e);this._cancelEvent("timer_check_session");if(typeof e=="object"){if(e.result=="ok"){if(e.has_connection){if(this._pageVisible()){this.transition("RESUMING")}else{this.transition("ONLINE");this.gui.showWidget()}}else{this.transition("RESUMING")}return}}this._newSession()},timer_check_session:function(){this._newSession()}},RESUMING:{_onEnter:function(){connection.resume(cookie("sess_id"))},resume_ok:function(e){this.createMagicIFrame();this.transition("ONLINE");if(!this.isMobile()||this.isSeparateWindow()){this.gui.showChat().handle("resume_ok",e)}else{this.gui.showWidget();var t=e.client_info.msg_history;for(var i=0;i<t.length;i++){if(t[i].type=="agentMessage"&&t[i].ack==0){this.gui.incrementCounter()}}}},resume_failed:function(){this._newSession()}},HIDDEN:{},IN_IFRAME:{_onEnter:function(){cookie("mframe",null);window.parent.jivo.handle("iframe_url_change",window.location.href,document.title)},highlight_cobrowse:function(e){this.gui.highlight(e)},"*":function(e){if(underscore.indexOf(["api_open","gui_close_cobrowse"],e)>=0){window.parent.jivo.handle.apply(window.parent.jivo,underscore.toArray(arguments))}else{log("JIVO: unhandled "+e+" in "+this.state)}}},INIT_RULE_MANAGER:{_onEnter:function(){underscore.defaults(config,{rules:[]});new Jivo.RuleManager(config.rules,underscore.bind(this.handle,this,"rule_manager_ready"))},rule_manager_ready:function(){if(config.chat_mode=="online"){if(config.rules.length==0){jivoProactiveInviter.handle("check_rules")}this.transition("ONLINE")}else{this.transition("OFFLINE")}this.gui.showWidget()},hide:"HIDDEN"},ONLINE:{_onEnter:function(){this.gui.setOnline()},api_open:function(e){this.handle("gui_maximize",e)},invitation:function(e,t){analytics.trackProactiveInvitationShown(t.name);this.ruleName=t.name;this.invitationText=t.invitationText;this.agentInfo=e;this.gui.showInvitation(this.agentInfo,this.invitationText);if(!this.isMobile()){this.transition("PROACTIVE")}},highlight_cobrowse:function(e){this.gui.highlight(e)},gui_close_cobrowse:function(e){this._stripHashFromLocation(e)},gui_maximize:function(e){this.openParams=e;analytics.trackChatOpenedByClick();jivoProactiveInviter.handle("cancel");if(this.isMobile()&&!cookie("sess_id")){var t=underscore.bind(function(e){if(e.inputType==="socket_message"&&e.args[0].name==="startup_ok"){connection.off("handled",t);this.handle("gui_maximize",this.openParams)}},this);connection.startup();connection.on("handled",t)}else{this.gui.showChat(true,this.openParams)}},gui_typing:function(e){connection.sendIfConnected({name:"client_typing",typing:e})},gui_introduced:function(e){connection.sendIfConnected({name:"introduction",client_name:e.name,phone:e.phone,email:e.email});this._saveClientInfo(e)},gui_message:function(e){this.createMagicIFrame();var t={name:"client_message",message:e};if(this.department_id){t.widget_department_id=this.department_id;this.department_id=null}connection.send(t);jivoProactiveInviter.handle("cancel");this.gui.handle("gui_message",e)},gui_department:function(e){this.department_id=e},gui_typing_insight:function(e){connection.sendIfConnected({name:"client_service_message",service:"typing_insight",event:"input_changed",new_val:e})},gui_minimize:function(){jivoTitle.stopBlink();this.gui.showWidget(true)},gui_decline_file:function(e,t){jivoTitle.stopBlink();connection.send({name:"client_service_message",service:"file_transfer",file_id:e,file_name:t,event:"file_declined"})},gui_accept_cobrowse:function(e,t){jivoTitle.stopBlink();var i=document.location.href.split("#")[0];var n=e+"#jvhs_"+t;var o=document.getElementById("jivo_magic_iframe");if(i==e||i==encodeURI(e)){try{var r=window;if(o){r=o.contentWindow}r.jivo.handle("highlight_cobrowse",t)}catch(a){log(a.toString());return}this._changeBrowserLocation(n,document.title)}else{if(o){site_iframe.navigate(n)}else{document.location.href=n}}},gui_evaluation:function(e,t){this._sendRate(e,t)},agent_chat_close:function(){this.invitationText=this.agentInfo=false;this.gui.handle("agent_chat_close")},gui_msg_input_focus:function(){jivoTitle.stopBlink()},"*":function(e){if(underscore.indexOf(["agent_message","agent_service_message","system_message","agent_typing","accept","agent_chat_close","gui_resume","update_height","transferred","update_agent_info","blacklist"],e)>=0){this.gui.handle.apply(this.gui,underscore.toArray(arguments));if(underscore.indexOf(["agent_message","agent_service_message"],e)>=0){jivoTitle.startBlink()}if(e=="accept"){analytics.trackChatConnected()}}else{log("JIVO: unhandled "+e+" in "+this.state)}},iframe_url_change:function(e,t){this._changeBrowserLocation(e,t);connection.sendIfConnected({name:"url_change",url:e,title:t})},reopened_elsewhere:function(){jivoTitle.stopBlink();this.gui.showWidget()},connect_failed:function(){this._forcedOffline="connect_failed";this.transition("OFFLINE");this.gui.handle("connect_failed")},force_offline:function(e){this._forcedOffline=e.err_code?e.err_code:e.name;this.transition("OFFLINE");this.gui.handle("connect_failed")},window_visible:function(){if(!connection.isConnected()){var e=cookie("sess_id");if(e){this._checkSession(e)}}},gui_start_call:function(){connection.handle("start_call")},gui_agent_message_ack:function(e){connection.sendIfConnected({name:"agent_message_ack",ack_msg_ids:e})}},OFFLINE:{_onEnter:function(){jivoTitle.stopBlink();this.gui.setOffline()},gui_maximize:function(){analytics.trackOfflineFormOpenedByClick();this.gui.showChat(true)},gui_minimize:function(){this.gui.showWidget(true)},gui_offline_message:function(e){var t=this.getCurrentPage();var i=underscore.pick(e,"email","message","phone","name","cap_id","cap_symbols");underscore.extend(i,{page_url:t.url,page_title:t.title});if(cookie("client_id")){i.client_id=cookie("client_id")}if(cookie("__utmz")){i.g_utmz=cookie("__utmz")}if(this._forcedOffline){i.from_online=this._forcedOffline}if(this.isMobile()){i.is_mobile=1}this._saveClientInfo(i);getJSONPWithData(config.base_url+"/script/offline-form/"+config.widget_id,i,underscore.bind(this.handle,this,"message_response"));this.transition("OFFLINE_WAIT")},gui_leave_msg:function(){this.gui.handle("gui_leave_msg")},api_open:function(){this.handle("gui_maximize")},update_height:function(e){this.gui.handle("update_height",e)}},OFFLINE_WAIT:{_onEnter:function(){this._scheduleEvent("message_timer",5e3)},message_response:function(e){this._cancelEvent("message_timer");if(typeof e=="object"){if(e.result=="ok"){if("client_id"in e){cookie("client_id",e.client_id,{expires:365,path:"/"})}analytics.trackOfflineMessageSent();this.gui.handle("offline_success");this.transition("OFFLINE");return}else if(e.result=="error"){if("cap_id"in e){this.gui.handle("offline_captcha",e);this.transition("OFFLINE");return}}}this.gui.handle("offline_failed");this.transition("OFFLINE")},message_timer:function(){this.gui.handle("offline_failed");this.transition("OFFLINE")}},PROACTIVE:{gui_minimize:function(){analytics.trackProactiveInvitationRejected(this.ruleName);this.gui.showWidget(true);this.transition("ONLINE")},gui_message:function(e){this.createMagicIFrame();analytics.trackProactiveInvitationAccepted(this.ruleName);cookie("agent_info",[this.agentInfo.agent_id].join("$$"));if(this.isMobile()){this.proactiveAnswer=e;return}connection.send({name:"client_message",message:e});this.gui.handle("gui_message",e);this.transition("ONLINE")},window_visible:function(){if(!connection.isConnected()){var e=cookie("sess_id");if(e){this._checkSession(e)}}}}}});if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(e){return e<10?"0"+e:e}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,o,r,a=gap,s,c=t[e];if(c&&typeof c==="object"&&typeof c.toJSON==="function"){c=c.toJSON(e)}if(typeof rep==="function"){c=rep.call(t,e,c)}switch(typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c){return"null"}gap+=indent;s=[];if(Object.prototype.toString.apply(c)==="[object Array]"){r=c.length;for(i=0;i<r;i+=1){s[i]=str(i,c)||"null"}o=s.length===0?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]";gap=a;return o}if(rep&&typeof rep==="object"){r=rep.length;for(i=0;i<r;i+=1){if(typeof rep[i]==="string"){n=rep[i];o=str(n,c);if(o){s.push(quote(n)+(gap?": ":":")+o)}}}}else{for(n in c){if(Object.prototype.hasOwnProperty.call(c,n)){o=str(n,c);if(o){s.push(quote(n)+(gap?": ":":")+o)}}}}o=s.length===0?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}";gap=a;return o}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,i){var n;gap="";indent="";if(typeof i==="number"){for(n=0;n<i;n+=1){indent+=" "}}else if(typeof i==="string"){indent=i}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(e,t){var i,n,o=e[t];if(o&&typeof o==="object"){for(i in o){if(Object.prototype.hasOwnProperty.call(o,i)){n=walk(o,i);if(n!==undefined){o[i]=n}else{delete o[i]}}}}return reviver.call(e,t,o)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();(function(e){var t=e.setTimeout,i=e.document,n=0;e.jivoXHR=function(){var o,r,a,s,c=null;function l(){try{s.parentNode.removeChild(s)}catch(e){}}function u(){r=false;o="";l();s=null}function f(e){try{c.onerror.call(c,e,o)}catch(t){throw new Error(e)}}function d(){if(this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded"||r){return}this.onload=this.onreadystatechange=null;r=true;if(c.readyState!==4){f("Script failed to load ["+o+"].")}l()}function h(e){e=e||[];c.readyState=4;c.status=200;if(typeof c.onload==="function"){c.onload.apply(c,e)}}c={onerror:null,onload:null,readyState:0,open:function(t,i){u();internal_callback="cb"+n++;(function(t){e.jivoXHR[t]=function(){try{h.call(c,arguments)}catch(i){c.readyState=-1;f(i.message)}e.jivoXHR[t]=null}})(internal_callback);o=i.replace(/=\?/,"=jivoXHR."+internal_callback)},send:function(){t(function(){s=i.createElement("script");s.setAttribute("type","text/javascript");s.charset="UTF-8";s.onload=s.onreadystatechange=function(){d.call(s)};s.setAttribute("src",o);i.getElementsByTagName("head")[0].appendChild(s)},0)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}};u();return c}})(window);var jivoConnection=function(){var e={host:"node.jivosite.com",push_host:"nodepsh.jivosite.com",plain_port:80,secure_port:443,secure:0,srv_rotate:1};var t="init";var i="cometcn";var n=0;var o=0;var r=0;var a=false;var s=[];var c={};var l={};var u={};var f=1e4;var d=5e3;var h=5e3;var g=0;var v="jsonp";function m(e){if("c"==e.t){n=e.sid;f=e.ht;t="processing";if("connect"in c){try{c.connect(n)}catch(i){reportException(i);Y.error("Got exception in connect callback: "+i.message)}}E()}}function p(e){T=0;if("k"==e.t){f=e.ht;E()}else if("m"==e.t){t="processing";o=e.mid;if("message"in c){try{c.message(e.msg)}catch(i){reportException(i);Y.error("Got exception in message callback: "+i.message)}}if(I){z()}else{A()}}else if("r"==e.t){w()}else if("d"==e.t){Y.info("Disconnect message");_();y(true,e.r)}}function _(){k("push_retry");if(a){k("push");b("push")}o=0;r=0;T=0;F=0;s=[];J=0;a=false;I=false;n=0;t="init"}function y(e,t){if("disconnect"in c){try{c.disconnect(e,t)}catch(i){reportException(i);Y.error("Got exception in disconnect callback: "+i.message)}}}function b(t,i){if(t in u){Y.info("aborting xhr "+t);u[t].onload=u[t].onerror=u[t].onreadystatechange=function(){};if(typeof i=="function"){u[t].onabort=i
}u[t].abort();delete u[t];if(e.srv_rotate){if(++g>5){g=0}Y.info("Server index changed to "+g)}}else{Y.warn(t+" xhr is not set!")}}function w(){Y.info("Connection was reset");_();if("connection_reset"in c){c.connection_reset()}}function C(t,n){var o;if(typeof n!="object"){n={}}n.t=(new Date).getTime();var r=e.host;if(t[0]=="push"){if(e.push_host){r=e.push_host}}if(e.srv_rotate){if(g>0){var a=r.split(".");a[0]+="-"+g;r=a.join(".")}}if(e.secure){o=["https:/",r+":"+e.secure_port,i].join("/")}else{o=["http:/",r+":"+e.plain_port,i].join("/")}o+="/"+t.join("/")+"?";if(v=="jsonp"){o+="cb=?&"}var s=[];for(var c in n){s.push(c+"="+encodeURIComponent(n[c]))}return o+s.join("&")}function E(){t="pulling";if(v=="xhr"){var e=u["pull"]=new XMLHttpRequest}else{var e=u["pull"]=new jivoXHR}e.open("GET",C(["pull",n]),true);e.onerror=M;e.onload=D;Y.debug("Send pull xhr");e.send();N()}var T=0;var j=0;var I=false;function x(){Y.info("start reconnect");f=2e3;k("pull");if(T>5){_();if("disconnect"in c){try{c.disconnect(false,"reconnect failed")}catch(e){reportException(e);Y.error("Got exception in disconnect callback: "+e.message)}}return}j=t;S("retry_ack",1e3,function(){T+=1;if(j=="acking"){A()}else if(j=="pulling"){E()}})}function N(){S("pull",f+3e3,function(){b("pull");x()})}function k(e){if(e in l){Y.debug("Clearing timer "+e);clearTimeout(l[e]);delete l[e]}else{Y.warn("Timer "+e+" was not set")}}function S(e,t,i){if(e in l){Y.error("Attempt to re-set timer "+e);return}Y.debug("Setting timer "+e+" with delay="+t);l[e]=setTimeout(function(){delete l[e];Y.info(e+" timer fired");i()},t)}function A(){t="acking";if(v=="xhr"){var e=u["pull"]=new XMLHttpRequest}else{var e=u["pull"]=new jivoXHR}e.open("GET",C(["ack",n],{mid:o}),true);e.onerror=M;e.onload=D;Y.debug("Send ack xhr");e.send();N()}var O=true;function D(e){k("pull");if(this.status==200){if(v!="jsonp"){try{var t=JSON.parse(this.responseText)}catch(e){reportException(e);Y.error(e.message);R();return}p(t)}else{p(e)}}else{Y.error("pull xhr onload with status="+this.status);x()}}function M(e){Y.warn("pull_xhr error");x()}function L(){Y.info("Opening");if(!O){throw"Socket cannot be opened soon after connect failed"}if("init"==t){_();if(v=="xhr"){var e=u["syn"]=new XMLHttpRequest}else{var e=u["syn"]=new jivoXHR}e.open("GET",C(["syn"]),true);e.onerror=function(e){Y.warn("connect_xhr.onerror");k("syn");R()};e.onload=function(e){Y.debug("connect_xhr.onload");k("syn");if(this.status==200){if(v!="jsonp"){try{var t=JSON.parse(this.responseText)}catch(e){reportException(e);Y.error(e.message);R();return}m(t)}else{m(e)}}else{Y.error("connect_xhr.onload with status="+this.status);R()}};t="connecting";S("syn",d,function(){b("syn");R()});e.send()}else{Y.error("open in state="+t)}}function R(){t="init";Y.warn("Connection failed. Disabling open socket");O=false;setTimeout(function(){Y.info("Enabling open socket");O=true},1e3);if("connect_failed"in c){try{c.connect_failed()}catch(e){reportException(e);Y.error("Got exception in connect_failed callback: "+e.message)}}}function H(e){if(typeof e!="object"){return}switch(t){case"acking":case"pulling":case"processing":P(e);break;default:Y.error("Push in state="+t)}}function P(e){if(a){var t=s.push(e);Y.info("Message put to push queue with index="+t)}else{B(e)}}var J=0;function B(e){Y.debug("Sending message");J=e;a=true;if(v=="jsonp"){var t=u["push"]=new jivoXHR;t.open("GET",C(["push",n],{msg:JSON.stringify(e)}),true)}else{var t=u["push"]=new XMLHttpRequest;t.open("POST",C(["push",n]),true);t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}t.onerror=function(e){Y.warn("push xhr error");k("push");U()};t.onload=function(e){k("push");if(this.status==200){G()}else{U()}};S("push",h,function(){b("push");U()});t.send(JSON.stringify(e))}function G(){Y.debug("Processing push response");a=false;F=0;J=s.shift();if(J){B(J)}else{Y.info("Push queue is empty")}}var F=0;function U(){if(F++>50){Y.errors("Too many push errors");return}var e=500*(F+1);if(e>5e3){e=5e3}S("push_retry",e,function(){B(J)})}function V(){Y.debug("Close in state="+t);k("push_retry");switch(t){case"connecting":k("connect");b("connect");break;case"acking":break;case"pulling":break;case"processing":I=true;break}t="init"}var W=0;var q=0;function z(){t="closing";if(v=="xhr"){var e=u["fin"]=new XMLHttpRequest}else{var e=u["fin"]=new jivoXHR}e.open("GET",C(["fin",n],{mid:o}),true);e.onerror=function(e){Y.warn("fin xhr error");X()};e.onload=function(e){k("fin");X()};S("fin",1e3,function(){b("fin");X()});e.send()}function X(){Y.debug("Processing fin response");_();y(true,"Client socket close")}var Y={debug:function(e){log("jivoConnection:Debug:"+e)},info:function(e){log("jivoConnection:Info:"+e)},warn:function(e){log("jivoConnection:Warn:"+e)},error:function(e){log("jivoConnection:Error:"+e)}};if(typeof log4javascript!="undefined"){Y=log4javascript.getLogger("main")}return{init:function(t){if(typeof t=="object"){for(var i in t){Y.debug("Setting config "+i+" to "+t[i]);e[i]=t[i]}}var n=new XMLHttpRequest;if("withCredentials"in n){v="xhr"}n=null;Y.info("Mode="+v)},open:function(){L()},close:function(){V()},push:function(e){H(e)},on:function(e,t){c[e]=t}}}();var connection=new TimeMachine({namespace:"CONNECTION",msg_buf:[],sess_id:false,want_call:false,send:function(e){this.handle("send",e)},sendIfConnected:function(e){if(this.isConnected()){this.handle("send",e)}},resume:function(e){this.handle("resume",e)},startup:function(){this.handle("startup")},initialize:function(){jivoConnection.init(config.comet);var e=["connect","message","disconnect","connection_reset","connect_failed"];for(var t=0;t<e.length;t++){jivoConnection.on(e[t],underscore.bind(this.handle,this,"socket_"+e[t]))}},_sendSocketEvent:function(e){if(typeof e=="object"){if("name"in e){log("Sending "+e.name);jivoConnection.push(e)}else{this.warn("Attempt to send event without name")}}else{this.warn("Socket event must be object")}},_bufferMessage:function(e){this.msg_buf.push(e)},_flushMessageBuffer:function(){var e;while(e=this.msg_buf.pop()){jivoConnection.push(e)}},isConnected:function(){return this.state=="CONNECTED"},states:{uninitialized:{send:function(e){this._bufferMessage(e);this.transition("CONNECTING")},resume:function(e){this.sess_id=e;this.transition("CONNECTING")},start_call:function(){this.want_call=true;this.transition("CONNECTING")},startup:function(){this.sess_id=false;this.transition("CONNECTING")}},CONNECTING:{_onEnter:function(){jivoConnection.open()},socket_connect:function(){if(this.sess_id){this.transition("RESUMING")}else{this.transition("STARTING_UP")}},send:function(e){this._bufferMessage(e)},socket_connect_failed:function(){jivo.handle("connect_failed");this.transition("uninitialized")}},STARTING_UP:{_onEnter:function(){var e={name:"startup",jv_widget_id:config.widget_id,current_page:jivo.getCurrentPage(),is_mobile:jivo.isMobile()};if(cookie("client_id")){e.jv_client_id=cookie("client_id");log("CONNECTION: restored client #"+e.jv_client_id)}if(cookie("__utmz")){e.g_utmz=cookie("__utmz")}if(cookie("agent_info")){e.pa_id=cookie("agent_info").split("$$")[0];log("CONNECTION: restored agent #"+e.pa_id)}if(cookie("client_name")){e.client_name=cookie("client_name");log("CONNECTION: restored client name="+e.client_name)}if(cookie("email")){e.email=cookie("email");log("CONNECTION: restored client email="+e.email)}if(cookie("phone")){e.phone=cookie("phone");log("CONNECTION: restored client phone="+e.phone)}if(jivo.invitationText){e.proactive_rule={invitation_text:jivo.invitationText,agent_info:jivo.agentInfo}}if(this.want_call){e.want_call=true;this.want_call=false}this._sendSocketEvent(e)},send:function(e){this._bufferMessage(e)},socket_message:function(e){if(e.name=="startup_ok"){cookie("sess_id",e.jv_sess_id,{path:"/"});cookie("client_id",e.jv_client_id,{expires:365,path:"/"});this.transition("CONNECTED")}else if(e.name=="startup_error"){jivo.handle("force_offline",e);this.transition("DISCONNECTING")}}},RESUMING:{_onEnter:function(){this._sendSocketEvent({name:"resume",jv_sess_id:this.sess_id})},socket_message:function(e){if(e.name=="resume_ok"){jivo.handle(e.name,e);this.transition("CONNECTED")}else{this.sess_id=false;jivo.handle("resume_failed");this.transition("DISCONNECTING")}}},CONNECTED:{_onEnter:function(){this._flushMessageBuffer()},socket_message:function(e){if(underscore.indexOf(["agent_chat_close","force_offline","blacklist"],e.name)>=0){cookie("sess_id",null);try{window.opener.postMessage({action:"clear_session_id"},"*")}catch(t){}this.sess_id=false;if(e.name=="blacklist"){cookie("client_id","z"+cookie("client_id"))}this.transition("DISCONNECTING")}if(underscore.indexOf(["accept","transferred"],e.name)>=0){cookie("agent_info",[e.agent_info.agent_id].join("$$"))}jivo.handle(e.name,e)},send:function(e){jivoConnection.push(e)},socket_disconnect:function(e,t){log("CONNECTION: socket_disconnect, reason="+t);if(t=="resumed"){jivo.handle("reopened_elsewhere");this.transition("uninitialized")}}},DISCONNECTING:{_onEnter:function(){jivoConnection.close()},socket_disconnect:function(e,t){this.transition("uninitialized")}}}});var jivoProactiveInviter=new TimeMachine({namespace:"INVITER",setActiveRule:function(e){for(var t=0;t<config.proactive_rules.length;t++){if(config.proactive_rules[t].id==e){this.log("Matched rule is set to "+e);this.matchedRule=config.proactive_rules[t];return}}throw new Error("Rule with id="+e+" does not exist")},states:{uninitialized:{check_rules:function(){underscore.defaults(config,{proactive_rules:[]});if(config.proactive_rules.length==0){this.log("There is no rules!");this.transition("IDLE");return}var e=(new Date).getTime();var t=cookie("site_enter_time");if(t){t=parseInt(t)}else{t=e}var i=cookie("pages_count");if(!i){i=0}this.log("Clean url="+this.url);var n,o,r=false,a=cookie("close_time");if(a){a=parseInt(a)}else{a=0}for(var s=0;s<config.proactive_rules.length;s++){var n=config.proactive_rules[s];if(!n.invitationText){throw new Error("Invitation text is empty")}underscore.defaults(n,{name:n.invitationText,urlPrefix:[{url:"/",mm:0}],page_timeout:20,close_timeout:300,enter_timeout:0,pages_count:0});if(this.checkUrl(n.urlPrefix)){if(n.pages_count<=i){o=Math.max(e+n.page_timeout*1e3,t+n.enter_timeout*1e3,a+n.close_timeout*1e3);if(!r||o<r){this.matchedRule=n;r=o}}}}if(this.matchedRule){var c=r-e;this.log("Timeouting invite for "+c+" (rule="+this.matchedRule.name+")");this._scheduleEvent("invite",c);this.transition("PAUSE")}else{this.log("No proactive rules matched");this.transition("IDLE")}},cancel:"IDLE",api_show:function(e){this.setActiveRule(e);this.transition("LOADING_AGENT")}},PAUSE:{invite:"LOADING_AGENT",cancel:function(){this._cancelEvent("invite");this.transition("IDLE")},api_show:function(e){this.setActiveRule(e);this.transition("LOADING_AGENT")}},LOADING_AGENT:{_onEnter:function(){var e=this.restoreAgentInfo();var t={};if(e){t.agent_id=e.agent_id}this.log("Loading agent");getJSONPWithData(config.base_url+"/script/active-agent/"+config.widget_id,t,underscore.bind(this.handle,this,"agent_loaded"))},agent_loaded:function(e){if(typeof e=="object"){jivo.handle("invitation",e,this.matchedRule);this.transition("SHOWN")}else{this.log("Agent not found");this.transition("IDLE")}},api_show:function(e){this.setActiveRule(e)},cancel:"IDLE"},CLOSED:{api_show:function(e){throw new Error("Invitation was already closed")}},IDLE:{api_show:function(e){this.setActiveRule(e);this.transition("LOADING_AGENT")}},SHOWN:{close:"CLOSED",api_show:function(){throw new Error("Invitation is already displayed")}}},matchedRule:false,agent:false,url:window.location.href.replace("http://","").replace("https://",""),log:function(e){log("Proactive inviter: "+e)},checkUrl:function(e){var t;for(var i=0;i<e.length;i++){switch(e[i].mm){case 1:if(this.url==e[i].url){return true}break;case 2:try{t=new RegExp(e[i].url,"g")}catch(n){this.log("Regexp error="+n.toString());continue}if(t.test(this.url)){return true}break;default:if(this.url.toLowerCase().indexOf(e[i].url.toLowerCase())>=0){return true}}}return false},restoreAgentInfo:function(){var e=cookie("agent_info");if(e){var t=e.split("$$");return{agent_id:t[0]}}return false}});var JivoPhantom=TimeMachine.extend({namespace:"PHANTOM",element:false,type:"chat",PHANTOM_ID:"jivo_phantom",TIMEOUT_TRANSITION:300,TIMEOUT_TRANSITION_DEBOUNCE:1,initialize:function(){element=this.element=document.createElement("div");element.id=this.PHANTOM_ID;prefixedEvent(element,"TransitionEnd",this.handleTransitionEnd);this.topWrap.appendChild(element);addClass(element,"jivo-"+config.widget_orientation);element.style.background=config.widget_color;function e(){if(this._transitionEndTimeout){clearTimeout(this._transitionEndTimeout)}this.handle("animate_finished")}this.handleTransitionEnd=underscore.debounce(underscore.bind(e,this),this.TIMEOUT_TRANSITION_DEBOUNCE)},setRect:function(e){setElementPosition(this.element,e);return this},setTransition:function(e){toggleClass(this.element,"jivo-notransition",!e);return this},animate:function(e,t){var i=this.element;var n=this.state==="EXPANDING";toggleClass(i,"jivo-phantom-chat",n);toggleClass(i,"jivo-phantom-label",!n);this.setTransition(false).setRect(e,true).setTransition(true);setTimeout(underscore.bind(function(){this.setRect(t);this._transitionEndTimeout=setTimeout(this.handleTransitionEnd,this.TIMEOUT_TRANSITION)},this),0)},initialState:"HIDDEN",states:{ANIMATED:{_onEnter:function(){this.emit("animated");this._scheduleEvent("hide",this.TIMEOUT_TRANSITION)},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){this.setTransition(false)},collapse:function(e,t){this.transition("COLLAPSING");this.animate(t,e)},expand:function(e,t){this.transition("EXPANDING");this.animate(e,t)}},EXPANDING:{animate_finished:"ANIMATED"},COLLAPSING:{animate_finished:"ANIMATED"}}});var analytics={_trackedEvents:[],_trackEvent:function(e,t){if(underscore.indexOf(this._trackedEvents,e)>=0){return}this._trackedEvents.push(e);if(typeof _gaq!="undefined"){log("ANALYTICS: "+e+"/"+t);_gaq.push(["_trackEvent","JivoSite",e,t])}if(typeof ga=="function"){ga("send","event","JivoSite",e,t)}},trackChatOpenedByClick:function(){this._trackEvent("Chat requested","User clicked chat widget")},trackOfflineFormOpenedByClick:function(){this._trackEvent("Offline form shown","User offline form")},trackOfflineMessageSent:function(){this._trackEvent("Offline message sent","User sent message via offline form")},trackProactiveInvitationShown:function(e){this._trackEvent("Proactive invitation shown",e)},trackProactiveInvitationAccepted:function(e){this._trackEvent("Proactive invitation accepted",e)},trackProactiveInvitationRejected:function(e){this._trackEvent("Proactive invitation rejected",e)},trackChatConnected:function(){this._trackEvent("Chat established","User connected to agent")}};var jivo_api=window.jivo_api={open:function(e){jivo.handle("api_open",e)},showProactiveInvitation:function(e){jivoProactiveInviter.handle("api_show",e)}};var site_iframe={frm:0,create:function(){if(config.disable_iframe){log("Magic iframe is disabled");return}if(this.frm){log("Magic iframe already created");return}if(cookie("mframe")){log("Magic iframe create cancelled, page may be protected from iframe");return}cookie("mframe",1);log("Creating iframe");var e=document.createElement("iframe");e.setAttribute("id","jivo_magic_iframe");e.setAttribute("class","jivo-frame-hidden");e.setAttribute("frameborder","0px");e.setAttribute("name","col_old_page");document.body.appendChild(e);e.contentWindow.location=window.location;this.frm=e;setIframeLoadCallback(e,underscore.bind(this.onFrameLoaded,this))},onFrameLoaded:function(){log("Magic frame content loaded. Time to show the frame...");var e=document.getElementById("jivo_top_wrap");document.body.setAttribute("id","jivo_outer_body");document.body.style.overflow="hidden";document.body.scroll="no";var t=document.getElementsByTagName("iframe");for(var i=0;i<t.length;i++){var n=t[i];if(n.id!="jivo_magic_iframe"&&n.id!="jivo_chat_iframe"){n.style.display="none"}}this.frm.setAttribute("class","jivo-frame-visible");this.frm.style.display="block";if(ie7){document.body.removeChild(e);document.body.removeChild(this.frm);document.body.innerHTML="";document.body.appendChild(e);document.body.appendChild(this.frm)}if(this.hasScroll().vScrollbar){var o=this.getScrollBarWidth()+"px";log("Adjusting right margin. Scroll width="+o);document.getElementById("jivo-chat").style.marginRight=o;document.getElementById("jivo-label").style.marginRight=o}this.syncPageScroll()},navigate:function(e){log("navigating iframe to ",e);this.frm.contentDocument.location.href=e},getDoc:function(){var e=this.frm.contentWindow.document;if(!e)e=this.frm.contentDocument;if(!e){log("Cannot find document!! :(");return 0}return e},syncPageScroll:function(){var e=0,t=0;if(typeof window.pageYOffset=="number"){t=window.pageYOffset;e=window.pageXOffset}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){t=document.body.scrollTop;e=document.body.scrollLeft}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){t=document.documentElement.scrollTop;e=document.documentElement.scrollLeft}log("scroll pos x="+e+" y="+t);this.frm.contentWindow.scrollTo(e,t)},getScrollBarWidth:function(){var e=document.createElement("div");e.style.visibility="hidden";e.style.width="100px";document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%";e.appendChild(i);var n=i.offsetWidth;e.parentNode.removeChild(e);return t-n},hasScroll:function(){var e={vScrollbar:true,hScrollbar:true};try{var t=document.compatMode=="BackCompat"?document.body:document.documentElement;e.vScrollbar=t.scrollHeight>t.clientHeight;e.hScrollbar=t.scrollWidth>t.clientWidth}catch(i){}return e}};var jqueryFrame=window.childSandboxBridge={_queue:[],_ready:0,_inAir:0,process:function(e,t){var i=document.getElementById("jivo_frame");if(!i){if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir){this._inAir=true}var i=jivoFrame.init(function(){log("jivoFrame has been inited");if(window.parentSandboxBridge){window.parentSandboxBridge.process("onJqueryIframeReady")}childSandboxBridge._ready=true;childSandboxBridge.process()})}if(!this._ready){this._queue.push({name:e,params:t});return}if(this._queue.length){var n=this._queue.shift();e=n.name;t=n.params}if(this.inAir()){log("controller of childSandboxBridge set as for Air");var o=i.contentWindow.jqueryFrameControllerForAir;var r=document.createElement("link");r.setAttribute("rel","stylesheet");r.setAttribute("href",config.base_url+"/css/for_air.css?rnd=2");document.body.appendChild(r);o.init()}else{var o=i.contentWindow.jqueryFrameController}log("childSandboxBridge has received event "+e);if(o[e]){o[e](t)}else{log("controller has not "+e)}if(this._queue.length)this.process()},inAir:function(){return this._inAir}};if(window.parentSandboxBridge){var log=function(e){window.parentSandboxBridge.log(e)};log("parentSandboxBridge.initInterface() called");window.parentSandboxBridge.initInterface()}var jivoFrame={_content:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>		<html>		<head>			<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />			<script type='text/javascript'  src='"+config.base_url+"/js/jquery_frame.js'></script>			<script type='text/javascript'>    lblDefaultCobrowseComment='"+translate("lblDefaultCobrowseComment")+"';			</script>		</head>		<body >		</body>        </html>",_iframe:0,init:function(e){this._iframe=document.createElement("iframe");this._iframe.setAttribute("id","jivo_frame");this._iframe.setAttribute("frameBorder","0");this._iframe.setAttribute("scrolling","no");this._iframe.allowTransparency=true;this._iframe.style.backgroundColor="transparent";window.document.body.appendChild(this._iframe);setIframeLoadCallback(this._iframe,e);this._doc=this._getDoc();this._doc.open();this._doc.write(this._content);this._doc.close();this._window=this._iframe.contentWindow;this._iframe.contentWindow.controller=this;return this._iframe},_getDoc:function(){if(this._iframe.contentDocument){return this._iframe.contentDocument}else if(this._iframe.contentWindow){return this._iframe.contentWindow.document}else{log("WARNING! chat_iframe._doc is null");return 0}}}})();if(jivo.isMobile()){var widgetLoaded=setInterval(function(){var e=document.getElementById("jivo_top_wrap");if(e){e.className+="mobile-version";jivoMobileLabel();clearInterval(widgetLoaded)}},100)}function jivoMobileLabel(){if(!document.querySelector("meta[name=viewport]")){var e=document.createElement("meta");e.id="viewport";e.name="viewport";e.content="width=device-width, height=device-height, initial-scale=0.33, maximum-scale=1.2";document.getElementsByTagName("head")[0].appendChild(e)}else{var t=document.querySelector("meta[name=viewport]").getAttribute("content").split(","),i,n=false;for(var o=0;o<t.length;o++){t[o]=t[o].replace(/^\s+/,"");var r=t[o].split("=");if(r[0]=="maximum-scale"){n=true;if(r[1]>1){r[1]="1.2"}}t[o]=r[0]+"="+r[1]}if(!n){t.push("maximum-scale=1.2")}i=t.join(", ");document.querySelector("meta[name=viewport]").setAttribute("content",i)}setInterval(function(){if(document.getElementById("jivo-label")){var e=0,t=290,i=500;var n=window.innerWidth||window.pageXOffset||document.documentElement.clientWidth||document.getElementsByTagName("html")[0];var o=(n/t).toFixed(3);if(window.matchMedia("(orientation: landscape)").matches||Math.abs(window.orientation)===90){o=(n/i).toFixed(3)}if(o!=e){document.getElementById("jivo-label").style["zoom"]=o;e=o}}},100)}